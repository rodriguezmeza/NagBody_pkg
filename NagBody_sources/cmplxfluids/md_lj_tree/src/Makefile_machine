# ----- MAKE FILE machine defintions -----
# Copyright (c) 2006-2022  M.A. Rodriguez-Meza, Mexico, D.F.
#
# ========================================
# Choose the machine you are running on. 
# Set paths to mpicc, FFTW3 GSL... below
# ========================================
#
#MACHINE  = MACPORTS
MACHINE = MACBREW
#MACHINE = MACCLANG
#MACHINE = MACOTHER
#MACHINE = MACUBUNTU
#MACHINE = MACINTEL

CCFLAGS =
LDFLAGS =
LIBS =
OPT1 =
OPT2 =

#--------------------------------------------
# Set local options to this code
# 	INCLUDES :: OPT1
# 	OTHER OPTIONS :: OPT2
# Some of this definitions can be set in a particular machine
#
OPT1    +=  -I ./
OPT1    +=  -I ./general_libs/general
OPT1    +=  -I ./general_libs/math
OPT1    +=  -I ./general_libs/io
# Add as many as needed
#
#OPT2   +=  -DOPTIONNAME
# Add as many as needed

INCLUDES = $(OPT1)

#PRECISION = DOUBLEPREC

#--------------------------------------------
# BEGIN MACHINE DEFINITIONS (ARCHITECTURES)
#
ifeq ($(MACHINE), MACPORTS)
  CC = gcc
  FC = gfortran
  F90C = gfortran
  F90 = gfortran
  OPTIMIZE = -O3 -fopenmp
endif

ifeq ($(MACHINE), MACBREW)
  CC = gcc
  FC = gfortran
  F90C = gfortran
  F90 = gfortran
  OPTIMIZE = -O3 -Wall -std=c99
  OMPFLAG = -fopenmp
  CCFLAGS += -g -fPIC
  LDFLAGS += -g -fPIC
  MLIBS = -lm
endif

ifeq ($(MACHINE), MACCLANG)
  CC = clang
  F90C = gfortran
  F90 = gfortran
  OPTIMIZE = -O2
endif

ifeq ($(MACHINE), MACOTHER)
  CC = gcc
  F90C = gfortran
  F90 = gfortran
  OPTIMIZE = -O3 -fopenmp -I/opt/local/lib/gcc8/gcc/x86_64-apple-darwin18/8.3.0/include/ssp/
endif

ifeq ($(MACHINE), MACUBUNTU)
  CC = gcc
  F90C = gfortran
  F90 = gfortran
  OPTIMIZE = -O3 -fopenmp
  MLIBS = -lm
endif

ifeq ($(MACHINE), MACINTEL)
  CC = icc
  F90C = ifort
  F90 = ifort
  OPTIMIZE = -O3
  OMPFLAG = -openmp
endif

ifeq ($(MACHINE), MACBREWMPI)
  CC = mpicc
  FC = mpif77
  F90C = mpif90
  F90 = mpif90

  NAGBODYDIR = $(HOME)/NagBody_pkg

ifdef SINGLE_PRECISION
  FFTW_INCL= -I$(NAGBODYDIR)/local/fftw3/include
  FFTW_LIBS= -L$(NAGBODYDIR)/local/fftw3/lib -lfftw3f_mpi -lfftw3f
else
  FFTW_INCL= -I$(NAGBODYDIR)/local/fftw3/include
  FFTW_LIBS= -L$(NAGBODYDIR)/local/fftw3/lib -lfftw3_mpi -lfftw3
endif
  GSL_INCL =  -I$(HOME)/NagBody_pkg/local/gsl/include
  GSL_LIBS =  -L$(HOME)/NagBody_pkg/local/gsl/lib -lgsl -lgslcblas
  MPI_INCL  = -I/opt/local/include/openmpi-mp/
  MPI_LIBS  = -L/opt/local/lib/openmpi-mp/ -lmpi

  OPTIMIZE = -O3
  OMPFLAG = -fopenmp
  CCFLAGS += -g -fPIC $(FFTW_INCL) $(GSL_INCL) $(MPI_INCL) $(OPTIONS)
  LDFLAGS += -g -fPIC
  LIBS +=  $(MPI_LIBS) $(FFTW_LIBS) $(GSL_LIBS)
  MLIBS =
endif

ifeq ($(MACHINE), MACPORTSMPI)
  CC = mpicc
  FC = mpif77
  F90C = mpif90
  F90 = mpif90

  NAGBODYDIR = $(HOME)/NagBody_pkg

ifdef SINGLE_PRECISION
  FFTW_INCL= -I/opt/local/include
  FFTW_LIBS= -L/opt/local/lib -lfftw3f_mpi -lfftw3f
else
  FFTW_INCL= -I/opt/local/include
  FFTW_LIBS= -L/opt/local/lib -lfftw3_mpi -lfftw3
endif
  GSL_INCL =  -I/opt/local/include
  GSL_LIBS =  -L/opt/local/lib -lgsl -lgslcblas
  MPI_INCL  = -I/opt/local/include/openmpi-mp/
  MPI_LIBS  = -L/opt/local/lib/openmpi-mp/ -lmpi

  OPTIMIZE = -O3
  OMPFLAG = -fopenmp
  CCFLAGS += -g -fPIC $(FFTW_INCL) $(GSL_INCL) $(MPI_INCL) $(OPTIONS)
  LDFLAGS += -g -fPIC
  LIBS +=  $(MPI_LIBS) $(FFTW_LIBS) $(GSL_LIBS)
  MLIBS =
endif

# END MACHINE DEFINITIONS
#--------------------------------------------


# BEGIN OLD MACHINE DEFINITIONS

# MEDUSA (Origin 8 cpu's 4 Gb RAM)
#   Remember to export MP_SET_NUMTHREADS=3
#CC = cc
#CCFLAGS = -64 -apo -Ofast=ip27 -r12000 
#LDFLAGS = -64 -apo -Ofast=ip27 -r12000
#CCFLAGS = -O3 -n32 
#LDFLAGS = -O3 -n32 

# NEUTRINO (Origin 8cpu's 2gb RAM)  
#CC = cc
#CCFLAGS = -64 -mp -Ofast=ip27 -r10000
#LDFLAGS = -64 -mp -Ofast=ip27 -r10000
#CCFLAGS = -n32 -mips4 -O3
#LDFLAGS = -n32 -mips4 -O3
#CCFLAGS = -64 -Ofast=ip27 -r10000
#LDFLAGS = -64 -Ofast=ip27 -r10000

# DEMI1 (SP2 IBM node 1) 
#    also change the lines to compile sphibm.f file and mv *.f90 to *.f
#		and change the lines which have *.f90 to *.f
#CC = cc
#CCFLAGS = -O3
#LDFLAGS = -O3

# VIVI (43P IBM) 
#    also change the lines to compile sphibm.f file and mv *.f90 to *.f
#CC = cc
#CCFLAGS = -qarch=pwr3 -qtune=pwr3 -O3
#LDFLAGS = -qarch=pwr3 -qtune=pwr3 -O3

# PC169 (SGI 1400 system 4 cpu's)
#CC = cc
#CCFLAGS = -O
#LDFLAGS = -O

# Mac OS X
#CC = gcc
#CCFLAGS = -O
#LDFLAGS = -O

# SGI ALTRIX 350 (OLD VERSION)
#CC = /opt/intel_cc_80/bin/icc
#CCFLAGS = -O
#LDFLAGS = -O -L/opt/intel_cc_80/lib

# SGI ALTRIX 350 Con los path ya definidos
#CC = icc
#CCFLAGS = -O
#LDFLAGS = -O -L/opt/intel_cc_80/lib

# END OLD MACHINE DEFINITIONS
#--------------------------------------------

