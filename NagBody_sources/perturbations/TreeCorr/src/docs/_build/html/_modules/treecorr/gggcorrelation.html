<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>treecorr.gggcorrelation &mdash; TreeCorr 4.2.8 documentation</title><link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> TreeCorr
          </a>
              <div class="version">
                4.2
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../catalog.html">Input Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../correlation2.html">Two-point Correlation Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../correlation3.html">Three-point Correlation Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../metric.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../binning.html">Binning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../patches.html">Patches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cov.html">Covariance Estimates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../field.html">Fields</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scripts.html">Using configuration files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guide.html">Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changes.html">Changes from version 4.1 to 4.2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changes.html#changes-from-version-4-2-0-to-4-2-1">Changes from version 4.2.0 to 4.2.1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changes.html#changes-from-version-4-2-1-to-4-2-2">Changes from version 4.2.1 to 4.2.2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changes.html#changes-from-version-4-2-2-to-4-2-3">Changes from version 4.2.2 to 4.2.3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changes.html#changes-from-version-4-2-3-to-4-2-4">Changes from version 4.2.3 to 4.2.4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changes.html#changes-from-version-4-2-4-to-4-2-5">Changes from version 4.2.4 to 4.2.5</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changes.html#changes-from-version-4-2-5-to-4-2-6">Changes from version 4.2.5 to 4.2.6</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changes.html#changes-from-version-4-2-6-to-4-2-7">Changes from version 4.2.6 to 4.2.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changes.html#changes-from-version-4-2-7-to-4-2-8">Changes from version 4.2.7 to 4.2.8</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../history.html">Previous History</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">TreeCorr</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Module code</a> &raquo;</li>
      <li>treecorr.gggcorrelation</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for treecorr.gggcorrelation</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright (c) 2003-2019 by Mike Jarvis</span>
<span class="c1">#</span>
<span class="c1"># TreeCorr is free software: redistribution and use in source and binary forms,</span>
<span class="c1"># with or without modification, are permitted provided that the following</span>
<span class="c1"># conditions are met:</span>
<span class="c1">#</span>
<span class="c1"># 1. Redistributions of source code must retain the above copyright notice, this</span>
<span class="c1">#    list of conditions, and the disclaimer given in the accompanying LICENSE</span>
<span class="c1">#    file.</span>
<span class="c1"># 2. Redistributions in binary form must reproduce the above copyright notice,</span>
<span class="c1">#    this list of conditions, and the disclaimer given in the documentation</span>
<span class="c1">#    and/or other materials provided with the distribution.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">.. module:: nnncorrelation</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">_lib</span><span class="p">,</span> <span class="n">_ffi</span>
<span class="kn">from</span> <span class="nn">.catalog</span> <span class="kn">import</span> <span class="n">calculateVarG</span>
<span class="kn">from</span> <span class="nn">.binnedcorr3</span> <span class="kn">import</span> <span class="n">BinnedCorr3</span>
<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">double_ptr</span> <span class="k">as</span> <span class="n">dp</span>
<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">gen_read</span><span class="p">,</span> <span class="n">gen_write</span><span class="p">,</span> <span class="n">gen_multi_read</span><span class="p">,</span> <span class="n">gen_multi_write</span>


<div class="viewcode-block" id="GGGCorrelation"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCorrelation">[docs]</a><span class="k">class</span> <span class="nc">GGGCorrelation</span><span class="p">(</span><span class="n">BinnedCorr3</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;This class handles the calculation and storage of a 3-point shear-shear-shear correlation</span>
<span class="sd">    function.</span>

<span class="sd">    We use the &quot;natural components&quot; of the shear 3-point function described by Schneider &amp;</span>
<span class="sd">    Lombardi (2003) [Astron.Astrophys. 397 (2003) 809-818].  In this paradigm, the shears</span>
<span class="sd">    are projected relative to some point defined by the geometry of the triangle.  They</span>
<span class="sd">    give several reasonable choices for this point.  We choose the triangle&#39;s centroid as the</span>
<span class="sd">    &quot;most natural&quot; point, as many simple shear fields have purely real :math:`\Gamma_0` using</span>
<span class="sd">    this definition.  It is also a fairly simple point to calculate in the code compared to</span>
<span class="sd">    some of the other options they offer, so projections relative to it are fairly efficient.</span>

<span class="sd">    There are 4 complex-valued 3-point shear corrletion functions defined for triples of shear</span>
<span class="sd">    values projected relative to the line joining the location of the shear to the cenroid of</span>
<span class="sd">    the triangle:</span>

<span class="sd">    .. math::</span>

<span class="sd">        \Gamma_0 &amp;= \langle \gamma(\mathbf{x1}) \gamma(\mathbf{x2}) \gamma(\mathbf{x3}) \rangle \\</span>
<span class="sd">        \Gamma_1 &amp;= \langle \gamma(\mathbf{x1})^* \gamma(\mathbf{x2}) \gamma(\mathbf{x3}) \rangle \\</span>
<span class="sd">        \Gamma_2 &amp;= \langle \gamma(\mathbf{x1}) \gamma(\mathbf{x2})^* \gamma(\mathbf{x3}) \rangle \\</span>
<span class="sd">        \Gamma_3 &amp;= \langle \gamma(\mathbf{x1}) \gamma(\mathbf{x2}) \gamma(\mathbf{x3})^* \rangle \\</span>

<span class="sd">    where :math:`\mathbf{x1}, \mathbf{x2}, \mathbf{x3}` are the corners of the triange opposite</span>
<span class="sd">    sides d1, d2, d3 respectively, where d1 &gt; d2 &gt; d3, and :math:`{}^*` indicates complex</span>
<span class="sd">    conjugation.</span>

<span class="sd">    See the doc string of `BinnedCorr3` for a description of how the triangles</span>
<span class="sd">    are binned.</span>

<span class="sd">    This class only holds one set of these :math:`\Gamma` functions, which means that it is only</span>
<span class="sd">    directly applicable for computing auto-correlations.  To describe a cross-correlation of one</span>
<span class="sd">    shear field with another, you need three sets of these functions.  To describe a three-way</span>
<span class="sd">    cross-correlation of three different shear fields, you need six.  These use cases are</span>
<span class="sd">    enabled by the class `GGGCrossCorrelation` which holds six instances of this class to keep</span>
<span class="sd">    track of all the various triangles.  See that class for more details.</span>

<span class="sd">    Ojects of this class holds the following attributes:</span>

<span class="sd">    Attributes:</span>
<span class="sd">        nbins:      The number of bins in logr where r = d2</span>
<span class="sd">        bin_size:   The size of the bins in logr</span>
<span class="sd">        min_sep:    The minimum separation being considered</span>
<span class="sd">        max_sep:    The maximum separation being considered</span>
<span class="sd">        nubins:     The number of bins in u where u = d3/d2</span>
<span class="sd">        ubin_size:  The size of the bins in u</span>
<span class="sd">        min_u:      The minimum u being considered</span>
<span class="sd">        max_u:      The maximum u being considered</span>
<span class="sd">        nvbins:     The number of bins in v where v = +-(d1-d2)/d3</span>
<span class="sd">        vbin_size:  The size of the bins in v</span>
<span class="sd">        min_v:      The minimum v being considered</span>
<span class="sd">        max_v:      The maximum v being considered</span>
<span class="sd">        logr1d:     The nominal centers of the nbins bins in log(r).</span>
<span class="sd">        u1d:        The nominal centers of the nubins bins in u.</span>
<span class="sd">        v1d:        The nominal centers of the nvbins bins in v.</span>

<span class="sd">    In addition, the following attributes are numpy arrays whose shape is (nbins, nubins, nvbins):</span>

<span class="sd">    Attributes:</span>
<span class="sd">        logr:       The nominal center of each bin in log(r).</span>
<span class="sd">        rnom:       The nominal center of the bin converted to regular distance.</span>
<span class="sd">                    i.e. r = exp(logr).</span>
<span class="sd">        u:          The nominal center of each bin in u.</span>
<span class="sd">        v:          The nominal center of each bin in v.</span>
<span class="sd">        meand1:     The (weighted) mean value of d1 for the triangles in each bin.</span>
<span class="sd">        meanlogd1:  The mean value of log(d1) for the triangles in each bin.</span>
<span class="sd">        meand2:     The (weighted) mean value of d2 (aka r) for the triangles in each bin.</span>
<span class="sd">        meanlogd2:  The mean value of log(d2) for the triangles in each bin.</span>
<span class="sd">        meand2:     The (weighted) mean value of d3 for the triangles in each bin.</span>
<span class="sd">        meanlogd2:  The mean value of log(d3) for the triangles in each bin.</span>
<span class="sd">        meanu:      The mean value of u for the triangles in each bin.</span>
<span class="sd">        meanv:      The mean value of v for the triangles in each bin.</span>
<span class="sd">        gam0:       The 0th &quot;natural&quot; correlation function, :math:`\Gamma_0(r,u,v)`.</span>
<span class="sd">        gam1:       The 1st &quot;natural&quot; correlation function, :math:`\Gamma_1(r,u,v)`.</span>
<span class="sd">        gam2:       The 2nd &quot;natural&quot; correlation function, :math:`\Gamma_2(r,u,v)`.</span>
<span class="sd">        gam3:       The 3rd &quot;natural&quot; correlation function, :math:`\Gamma_3(r,u,v)`.</span>
<span class="sd">        vargam0:    The variance of :math:`\Gamma_0`, only including the shot noise</span>
<span class="sd">                    propagated into the final correlation.  This (and the related values for</span>
<span class="sd">                    1,2,3) does not include sample variance, so it is always an underestimate</span>
<span class="sd">                    of the actual variance.</span>
<span class="sd">        vargam1:    The variance of :math:`\Gamma_1`.</span>
<span class="sd">        vargam2:    The variance of :math:`\Gamma_2`.</span>
<span class="sd">        vargam3:    The variance of :math:`\Gamma_3`.</span>
<span class="sd">        weight:     The total weight in each bin.</span>
<span class="sd">        ntri:       The number of triangles going into each bin (including those where one or</span>
<span class="sd">                    more objects have w=0).</span>

<span class="sd">    If ``sep_units`` are given (either in the config dict or as a named kwarg) then the distances</span>
<span class="sd">    will all be in these units.</span>

<span class="sd">    .. note::</span>

<span class="sd">        If you separate out the steps of the `process` command and use `process_auto` and/or</span>
<span class="sd">        `process_cross`, then the units will not be applied to ``meanr`` or ``meanlogr`` until</span>
<span class="sd">        the `finalize` function is called.</span>

<span class="sd">    The typical usage pattern is as follows::</span>

<span class="sd">        &gt;&gt;&gt; ggg = treecorr.GGGCorrelation(config)</span>
<span class="sd">        &gt;&gt;&gt; ggg.process(cat)              # For auto-correlation.</span>
<span class="sd">        &gt;&gt;&gt; ggg.process(cat1,cat2,cat3)   # For cross-correlation.</span>
<span class="sd">        &gt;&gt;&gt; ggg.write(file_name)          # Write out to a file.</span>
<span class="sd">        &gt;&gt;&gt; gam0 = ggg.gam0, etc.         # To access gamma values directly.</span>
<span class="sd">        &gt;&gt;&gt; gam0r = ggg.gam0r             # You can also access real and imag parts separately.</span>
<span class="sd">        &gt;&gt;&gt; gam0i = ggg.gam0i</span>

<span class="sd">    Parameters:</span>
<span class="sd">        config (dict):  A configuration dict that can be used to pass in kwargs if desired.</span>
<span class="sd">                        This dict is allowed to have addition entries besides those listed</span>
<span class="sd">                        in `BinnedCorr3`, which are ignored here. (default: None)</span>
<span class="sd">        logger:         If desired, a logger object for logging. (default: None, in which case</span>
<span class="sd">                        one will be built according to the config dict&#39;s verbose level.)</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">        **kwargs:       See the documentation for `BinnedCorr3` for the list of allowed keyword</span>
<span class="sd">                        arguments, which may be passed either directly or in the config dict.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="GGGCorrelation.__init__"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCorrelation.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize `GGGCorrelation`.  See class doc for details.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">BinnedCorr3</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_ro</span><span class="o">.</span><span class="n">_d1</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># GData</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ro</span><span class="o">.</span><span class="n">_d2</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># GData</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ro</span><span class="o">.</span><span class="n">_d3</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># GData</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logr</span><span class="o">.</span><span class="n">shape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam0r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam1r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam2r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam3r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam0i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam1i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam2i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam3i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vargam0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vargam1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vargam2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vargam3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meand1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanlogd1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meand2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanlogd2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meand3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanlogd3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ntri</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Finished building GGGCorr&#39;</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">gam0</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gam0r</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">gam0i</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">gam1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gam1r</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">gam1i</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">gam2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gam2r</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">gam2i</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">gam3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gam3r</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">gam3i</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">corr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_corr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_corr</span> <span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">BuildCorr3</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_d1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bintype</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_min_sep</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_sep</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nbins</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_bin_size</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">min_u</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">max_u</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nubins</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ubin_size</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">bu</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">min_v</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">max_v</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nvbins</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">vbin_size</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">bv</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">xperiod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yperiod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zperiod</span><span class="p">,</span>
                    <span class="n">dp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gam0r</span><span class="p">),</span> <span class="n">dp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gam0i</span><span class="p">),</span> <span class="n">dp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gam1r</span><span class="p">),</span> <span class="n">dp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gam1i</span><span class="p">),</span>
                    <span class="n">dp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gam2r</span><span class="p">),</span> <span class="n">dp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gam2i</span><span class="p">),</span> <span class="n">dp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gam3r</span><span class="p">),</span> <span class="n">dp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gam3i</span><span class="p">),</span>
                    <span class="n">dp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meand1</span><span class="p">),</span> <span class="n">dp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meanlogd1</span><span class="p">),</span> <span class="n">dp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meand2</span><span class="p">),</span> <span class="n">dp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meanlogd2</span><span class="p">),</span>
                    <span class="n">dp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meand3</span><span class="p">),</span> <span class="n">dp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meanlogd3</span><span class="p">),</span> <span class="n">dp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meanu</span><span class="p">),</span> <span class="n">dp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meanv</span><span class="p">),</span>
                    <span class="n">dp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">),</span> <span class="n">dp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ntri</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_corr</span>

    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Using memory allocated from the C layer means we have to explicitly deallocate it</span>
        <span class="c1"># rather than being able to rely on the Python memory manager.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_corr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_ffi</span><span class="o">.</span><span class="n">_lock</span><span class="o">.</span><span class="n">locked</span><span class="p">():</span> <span class="c1"># pragma: no branch</span>
                <span class="n">_lib</span><span class="o">.</span><span class="n">DestroyCorr3</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bintype</span><span class="p">)</span>

<div class="viewcode-block" id="GGGCorrelation.__eq__"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCorrelation.__eq__">[docs]</a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return whether two `GGGCorrelation` instances are equal&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">GGGCorrelation</span><span class="p">)</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nbins</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">nbins</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bin_size</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">bin_size</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">min_sep</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">min_sep</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_sep</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">max_sep</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sep_units</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">sep_units</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">min_u</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">min_u</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_u</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">max_u</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nubins</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">nubins</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ubin_size</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">ubin_size</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">min_v</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">min_v</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_v</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">max_v</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nvbins</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">nvbins</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vbin_size</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">vbin_size</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coords</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">coords</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bin_type</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">bin_type</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bin_slop</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">bin_slop</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">xperiod</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">xperiod</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">yperiod</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">yperiod</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">zperiod</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">zperiod</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meand1</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">meand1</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meanlogd1</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">meanlogd1</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meand2</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">meand2</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meanlogd2</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">meanlogd2</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meand3</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">meand3</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meanlogd3</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">meanlogd3</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meanu</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">meanu</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meanv</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">meanv</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gam0r</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">gam0r</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gam0i</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">gam0i</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gam1r</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">gam1r</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gam1i</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">gam1i</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gam2r</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">gam2r</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gam2i</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">gam2i</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gam3r</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">gam3r</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gam3i</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">gam3i</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vargam0</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">vargam0</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vargam1</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">vargam1</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vargam2</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">vargam2</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vargam3</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">vargam3</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ntri</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">ntri</span><span class="p">))</span></div>

<div class="viewcode-block" id="GGGCorrelation.copy"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCorrelation.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Make a copy&quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">GGGCorrelation</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">GGGCorrelation</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="c1"># Only items that might change need to by deep copied.</span>
                <span class="n">ret</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># For everything else, shallow copy is fine.</span>
                <span class="c1"># In particular don&#39;t deep copy config or logger</span>
                <span class="c1"># Most of the rest are scalars, which copy fine this way.</span>
                <span class="n">ret</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>
        <span class="n">ret</span><span class="o">.</span><span class="n">_corr</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># We&#39;ll want to make a new one of these if we need it.</span>
        <span class="k">return</span> <span class="n">ret</span></div>

<div class="viewcode-block" id="GGGCorrelation.__repr__"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCorrelation.__repr__">[docs]</a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;GGGCorrelation(config=</span><span class="si">%r</span><span class="s1">)&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span></div>

<div class="viewcode-block" id="GGGCorrelation.process_auto"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCorrelation.process_auto">[docs]</a>    <span class="k">def</span> <span class="nf">process_auto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cat</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_threads</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process a single catalog, accumulating the auto-correlation.</span>

<span class="sd">        This accumulates the auto-correlation for the given catalog.  After</span>
<span class="sd">        calling this function as often as desired, the `finalize` command will</span>
<span class="sd">        finish the calculation of meand1, meanlogd1, etc.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            cat (Catalog):      The catalog to process</span>
<span class="sd">            metric (str):       Which metric to use.  See `Metrics` for details.</span>
<span class="sd">                                (default: &#39;Euclidean&#39;; this value can also be given in the</span>
<span class="sd">                                constructor in the config dict.)</span>
<span class="sd">            num_threads (int):  How many OpenMP threads to use during the calculation.</span>
<span class="sd">                                (default: use the number of cpu cores; this value can also be given</span>
<span class="sd">                                in the constructor in the config dict.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">cat</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Starting process GGG auto-correlations&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Starting process GGG auto-correlations for cat </span><span class="si">%s</span><span class="s1">.&#39;</span><span class="p">,</span> <span class="n">cat</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_metric</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="n">cat</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_num_threads</span><span class="p">(</span><span class="n">num_threads</span><span class="p">)</span>
        <span class="n">min_size</span><span class="p">,</span> <span class="n">max_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_minmax_size</span><span class="p">()</span>

        <span class="n">field</span> <span class="o">=</span> <span class="n">cat</span><span class="o">.</span><span class="n">getGField</span><span class="p">(</span><span class="n">min_size</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_method</span><span class="p">,</span>
                              <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brute</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Starting </span><span class="si">%d</span><span class="s1"> jobs.&#39;</span><span class="p">,</span><span class="n">field</span><span class="o">.</span><span class="n">nTopLevelNodes</span><span class="p">)</span>
        <span class="n">_lib</span><span class="o">.</span><span class="n">ProcessAuto3</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corr</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_dots</span><span class="p">,</span>
                                   <span class="n">field</span><span class="o">.</span><span class="n">_d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coords</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bintype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metric</span><span class="p">)</span></div>

<div class="viewcode-block" id="GGGCorrelation.process_cross12"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCorrelation.process_cross12">[docs]</a>    <span class="k">def</span> <span class="nf">process_cross12</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cat1</span><span class="p">,</span> <span class="n">cat2</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_threads</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process two catalogs, accumulating the 3pt cross-correlation, where one of the</span>
<span class="sd">        points in each triangle come from the first catalog, and two come from the second.</span>

<span class="sd">        This accumulates the cross-correlation for the given catalogs as part of a larger</span>
<span class="sd">        auto-correlation calculation.  E.g. when splitting up a large catalog into patches,</span>
<span class="sd">        this is appropriate to use for the cross correlation between different patches</span>
<span class="sd">        as part of the complete auto-correlation of the full catalog.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            cat1 (Catalog):     The first catalog to process. (1 point in each triangle will come</span>
<span class="sd">                                from this catalog.)</span>
<span class="sd">            cat2 (Catalog):     The second catalog to process. (2 points in each triangle will come</span>
<span class="sd">                                from this catalog.)</span>
<span class="sd">            metric (str):       Which metric to use.  See `Metrics` for details.</span>
<span class="sd">                                (default: &#39;Euclidean&#39;; this value can also be given in the</span>
<span class="sd">                                constructor in the config dict.)</span>
<span class="sd">            num_threads (int):  How many OpenMP threads to use during the calculation.</span>
<span class="sd">                                (default: use the number of cpu cores; this value can also be given</span>
<span class="sd">                                in the constructor in the config dict.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">cat1</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">cat2</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Starting process GGG (1-2) cross-correlations&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Starting process GGG (1-2) cross-correlations for cats </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">.&#39;</span><span class="p">,</span>
                             <span class="n">cat1</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">cat2</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_metric</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="n">cat1</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="n">cat2</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_num_threads</span><span class="p">(</span><span class="n">num_threads</span><span class="p">)</span>
        <span class="n">min_size</span><span class="p">,</span> <span class="n">max_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_minmax_size</span><span class="p">()</span>

        <span class="n">f1</span> <span class="o">=</span> <span class="n">cat1</span><span class="o">.</span><span class="n">getGField</span><span class="p">(</span><span class="n">min_size</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_method</span><span class="p">,</span>
                            <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brute</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
        <span class="n">f2</span> <span class="o">=</span> <span class="n">cat2</span><span class="o">.</span><span class="n">getGField</span><span class="p">(</span><span class="n">min_size</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_method</span><span class="p">,</span>
                            <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brute</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Starting </span><span class="si">%d</span><span class="s1"> jobs.&#39;</span><span class="p">,</span><span class="n">f1</span><span class="o">.</span><span class="n">nTopLevelNodes</span><span class="p">)</span>
        <span class="c1"># Note: all 3 correlation objects are the same.  Thus, all triangles will be placed</span>
        <span class="c1"># into self.corr, whichever way the three catalogs are permuted for each triangle.</span>
        <span class="n">_lib</span><span class="o">.</span><span class="n">ProcessCross12</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr</span><span class="p">,</span>
                            <span class="n">f1</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">f2</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_dots</span><span class="p">,</span>
                            <span class="n">f1</span><span class="o">.</span><span class="n">_d</span><span class="p">,</span> <span class="n">f2</span><span class="o">.</span><span class="n">_d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coords</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_bintype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metric</span><span class="p">)</span></div>

<div class="viewcode-block" id="GGGCorrelation.process_cross"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCorrelation.process_cross">[docs]</a>    <span class="k">def</span> <span class="nf">process_cross</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cat1</span><span class="p">,</span> <span class="n">cat2</span><span class="p">,</span> <span class="n">cat3</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_threads</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process a set of three catalogs, accumulating the 3pt cross-correlation.</span>

<span class="sd">        This accumulates the cross-correlation for the given catalogs as part of a larger</span>
<span class="sd">        auto-correlation calculation.  E.g. when splitting up a large catalog into patches,</span>
<span class="sd">        this is appropriate to use for the cross correlation between different patches</span>
<span class="sd">        as part of the complete auto-correlation of the full catalog.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            cat1 (Catalog):     The first catalog to process</span>
<span class="sd">            cat2 (Catalog):     The second catalog to process</span>
<span class="sd">            cat3 (Catalog):     The third catalog to process</span>
<span class="sd">            metric (str):       Which metric to use.  See `Metrics` for details.</span>
<span class="sd">                                (default: &#39;Euclidean&#39;; this value can also be given in the</span>
<span class="sd">                                constructor in the config dict.)</span>
<span class="sd">            num_threads (int):  How many OpenMP threads to use during the calculation.</span>
<span class="sd">                                (default: use the number of cpu cores; this value can also be given</span>
<span class="sd">                                in the constructor in the config dict.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">cat1</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">cat2</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">cat3</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Starting process GGG cross-correlations&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Starting process GGG cross-correlations for cats </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">.&#39;</span><span class="p">,</span>
                             <span class="n">cat1</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">cat2</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">cat3</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_metric</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="n">cat1</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="n">cat2</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="n">cat3</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_num_threads</span><span class="p">(</span><span class="n">num_threads</span><span class="p">)</span>
        <span class="n">min_size</span><span class="p">,</span> <span class="n">max_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_minmax_size</span><span class="p">()</span>

        <span class="n">f1</span> <span class="o">=</span> <span class="n">cat1</span><span class="o">.</span><span class="n">getGField</span><span class="p">(</span><span class="n">min_size</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_method</span><span class="p">,</span>
                            <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brute</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
        <span class="n">f2</span> <span class="o">=</span> <span class="n">cat2</span><span class="o">.</span><span class="n">getGField</span><span class="p">(</span><span class="n">min_size</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_method</span><span class="p">,</span>
                            <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brute</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
        <span class="n">f3</span> <span class="o">=</span> <span class="n">cat3</span><span class="o">.</span><span class="n">getGField</span><span class="p">(</span><span class="n">min_size</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_method</span><span class="p">,</span>
                            <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brute</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Starting </span><span class="si">%d</span><span class="s1"> jobs.&#39;</span><span class="p">,</span><span class="n">f1</span><span class="o">.</span><span class="n">nTopLevelNodes</span><span class="p">)</span>
        <span class="c1"># Note: all 6 correlation objects are the same.  Thus, all triangles will be placed</span>
        <span class="c1"># into self.corr, whichever way the three catalogs are permuted for each triangle.</span>
        <span class="n">_lib</span><span class="o">.</span><span class="n">ProcessCross3</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">corr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr</span><span class="p">,</span>
                           <span class="n">f1</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">f2</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">f3</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_dots</span><span class="p">,</span>
                           <span class="n">f1</span><span class="o">.</span><span class="n">_d</span><span class="p">,</span> <span class="n">f2</span><span class="o">.</span><span class="n">_d</span><span class="p">,</span> <span class="n">f3</span><span class="o">.</span><span class="n">_d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coords</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bintype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metric</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mask1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">!=</span> <span class="mi">0</span>
        <span class="n">mask2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">==</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gam0r</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam0i</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam1r</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam1i</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam2r</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam2i</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam3r</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam3i</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meand1</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanlogd1</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meand2</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanlogd2</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meand3</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanlogd3</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanu</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanv</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span>

        <span class="c1"># Update the units</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_units</span><span class="p">(</span><span class="n">mask1</span><span class="p">)</span>

        <span class="c1"># Use meanlogr when available, but set to nominal when no triangles in bin.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meand2</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnom</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanlogd2</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logr</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanu</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanv</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meand3</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">meand2</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanlogd3</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meand3</span><span class="p">[</span><span class="n">mask2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meand1</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">mask2</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">meand3</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">meand2</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanlogd1</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meand1</span><span class="p">[</span><span class="n">mask2</span><span class="p">])</span>

<div class="viewcode-block" id="GGGCorrelation.finalize"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCorrelation.finalize">[docs]</a>    <span class="k">def</span> <span class="nf">finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">varg1</span><span class="p">,</span> <span class="n">varg2</span><span class="p">,</span> <span class="n">varg3</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Finalize the calculation of the correlation function.</span>

<span class="sd">        The `process_auto` and `process_cross` commands accumulate values in each bin,</span>
<span class="sd">        so they can be called multiple times if appropriate.  Afterwards, this command</span>
<span class="sd">        finishes the calculation by dividing by the total weight.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            varg1 (float):  The shear variance for the first field.</span>
<span class="sd">            varg2 (float):  The shear variance for the second field.</span>
<span class="sd">            varg3 (float):  The shear variance for the third field.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_finalize</span><span class="p">()</span>
        <span class="n">mask1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">!=</span> <span class="mi">0</span>
        <span class="n">mask2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_var_num</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">varg1</span> <span class="o">*</span> <span class="n">varg2</span> <span class="o">*</span> <span class="n">varg3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cov</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimate_cov</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var_method</span><span class="p">)</span>
        <span class="c1"># Note: diagonal should be very close to pure real.  So ok to just copy real part.</span>
        <span class="n">diag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()</span>
        <span class="c1"># This should never trigger.  If you find this assert to fail, please post an</span>
        <span class="c1"># issue about it describing your use case that caused it to fail.</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">diag</span><span class="o">.</span><span class="n">imag</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">1.e-8</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">diag</span><span class="o">.</span><span class="n">real</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vargam0</span><span class="o">.</span><span class="n">ravel</span><span class="p">()[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_nbins</span><span class="p">]</span><span class="o">.</span><span class="n">real</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vargam1</span><span class="o">.</span><span class="n">ravel</span><span class="p">()[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">_nbins</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_nbins</span><span class="p">]</span><span class="o">.</span><span class="n">real</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vargam2</span><span class="o">.</span><span class="n">ravel</span><span class="p">()[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()[</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_nbins</span><span class="p">:</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_nbins</span><span class="p">]</span><span class="o">.</span><span class="n">real</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vargam3</span><span class="o">.</span><span class="n">ravel</span><span class="p">()[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()[</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_nbins</span><span class="p">:</span><span class="mi">4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_nbins</span><span class="p">]</span><span class="o">.</span><span class="n">real</span></div>

    <span class="k">def</span> <span class="nf">_clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear the data vectors</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam0r</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam0i</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam1r</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam1i</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam2r</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam2i</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam3r</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam3i</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vargam0</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vargam1</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vargam2</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vargam3</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meand1</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanlogd1</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meand2</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanlogd2</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meand3</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanlogd3</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanu</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanv</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ntri</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="mf">0.</span>

<div class="viewcode-block" id="GGGCorrelation.__iadd__"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCorrelation.__iadd__">[docs]</a>    <span class="k">def</span> <span class="fm">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a second `GGGCorrelation`&#39;s data to this one.</span>

<span class="sd">        .. note::</span>

<span class="sd">            For this to make sense, both `GGGCorrelation` objects should not have had `finalize`</span>
<span class="sd">            called yet.  Then, after adding them together, you should call `finalize` on the sum.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">GGGCorrelation</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Can only add another GGGCorrelation object&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nbins</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">nbins</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">min_sep</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">min_sep</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_sep</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">max_sep</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nubins</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">nubins</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">min_u</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">min_u</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_u</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">max_u</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nvbins</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">nvbins</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">min_v</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">min_v</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_v</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">max_v</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;GGGCorrelation to be added is not compatible with this one.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">other</span><span class="o">.</span><span class="n">nonzero</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_metric</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">metric</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam0r</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">gam0r</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam0i</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">gam0i</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam1r</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">gam1r</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam1i</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">gam1i</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam2r</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">gam2r</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam2i</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">gam2i</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam3r</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">gam3r</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam3i</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">gam3i</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meand1</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">meand1</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanlogd1</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">meanlogd1</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meand2</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">meand2</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanlogd2</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">meanlogd2</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meand3</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">meand3</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanlogd3</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">meanlogd3</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanu</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">meanu</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanv</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">meanv</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">weight</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ntri</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">ntri</span><span class="p">[:]</span>
        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="k">def</span> <span class="nf">_sum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">others</span><span class="p">):</span>
        <span class="c1"># Equivalent to the operation of:</span>
        <span class="c1">#     self._clear()</span>
        <span class="c1">#     for other in others:</span>
        <span class="c1">#         self += other</span>
        <span class="c1"># but no sanity checks and use numpy.sum for faster calculation.</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">gam0r</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">others</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gam0r</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">gam0i</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">others</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gam0i</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">gam1r</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">others</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gam1r</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">gam1i</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">others</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gam1i</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">gam2r</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">others</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gam2r</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">gam2i</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">others</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gam2i</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">gam3r</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">others</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gam3r</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">gam3i</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">others</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gam3i</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">meand1</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">others</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">meand1</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">meanlogd1</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">others</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">meanlogd1</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">meand2</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">others</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">meand2</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">meanlogd2</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">others</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">meanlogd2</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">meand3</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">others</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">meand3</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">meanlogd3</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">others</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">meanlogd3</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">meanu</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">others</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">meanu</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">meanv</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">others</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">meanv</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">weight</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">others</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">ntri</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">others</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ntri</span><span class="p">)</span>

<div class="viewcode-block" id="GGGCorrelation.process"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCorrelation.process">[docs]</a>    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cat1</span><span class="p">,</span> <span class="n">cat2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cat3</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_threads</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">comm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">low_mem</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">finalize</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute the 3pt correlation function.</span>

<span class="sd">        - If only 1 argument is given, then compute an auto-correlation function.</span>
<span class="sd">        - If 2 arguments are given, then compute a cross-correlation function with the</span>
<span class="sd">          first catalog taking one corner of the triangles, and the second taking two corners.</span>
<span class="sd">        - If 3 arguments are given, then compute a three-way cross-correlation function.</span>

<span class="sd">        All arguments may be lists, in which case all items in the list are used</span>
<span class="sd">        for that element of the correlation.</span>

<span class="sd">        .. note::</span>

<span class="sd">            For a correlation of multiple catalogs, it typically matters which corner of the</span>
<span class="sd">            triangle comes from which catalog, which is not kept track of by this function.</span>
<span class="sd">            The final accumulation will have d1 &gt; d2 &gt; d3 regardless of which input catalog</span>
<span class="sd">            appears at each corner.  The class which keeps track of which catalog appears</span>
<span class="sd">            in each position in the triangle is `GGGCrossCorrelation`.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            cat1 (Catalog):     A catalog or list of catalogs for the first G field.</span>
<span class="sd">            cat2 (Catalog):     A catalog or list of catalogs for the second G field.</span>
<span class="sd">                                (default: None)</span>
<span class="sd">            cat3 (Catalog):     A catalog or list of catalogs for the third G field.</span>
<span class="sd">                                (default: None)</span>
<span class="sd">            metric (str):       Which metric to use.  See `Metrics` for details.</span>
<span class="sd">                                (default: &#39;Euclidean&#39;; this value can also be given in the</span>
<span class="sd">                                constructor in the config dict.)</span>
<span class="sd">            num_threads (int):  How many OpenMP threads to use during the calculation.</span>
<span class="sd">                                (default: use the number of cpu cores; this value can also be given</span>
<span class="sd">                                in the constructor in the config dict.)</span>
<span class="sd">            comm (mpi4py.Comm): If running MPI, an mpi4py Comm object to communicate between</span>
<span class="sd">                                processes.  If used, the rank=0 process will have the final</span>
<span class="sd">                                computation. This only works if using patches. (default: None)</span>
<span class="sd">            low_mem (bool):     Whether to sacrifice a little speed to try to reduce memory usage.</span>
<span class="sd">                                This only works if using patches. (default: False)</span>
<span class="sd">            initialize (bool):  Whether to begin the calculation with a call to</span>
<span class="sd">                                `BinnedCorr3.clear`.  (default: True)</span>
<span class="sd">            finalize (bool):    Whether to complete the calculation with a call to `finalize`.</span>
<span class="sd">                                (default: True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">math</span>
        <span class="k">if</span> <span class="n">initialize</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cat1</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
            <span class="n">cat1</span> <span class="o">=</span> <span class="n">cat1</span><span class="o">.</span><span class="n">get_patches</span><span class="p">(</span><span class="n">low_mem</span><span class="o">=</span><span class="n">low_mem</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cat2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cat2</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
            <span class="n">cat2</span> <span class="o">=</span> <span class="n">cat2</span><span class="o">.</span><span class="n">get_patches</span><span class="p">(</span><span class="n">low_mem</span><span class="o">=</span><span class="n">low_mem</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cat3</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cat3</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
            <span class="n">cat3</span> <span class="o">=</span> <span class="n">cat3</span><span class="o">.</span><span class="n">get_patches</span><span class="p">(</span><span class="n">low_mem</span><span class="o">=</span><span class="n">low_mem</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cat2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cat3</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;For two catalog case, use cat1,cat2, not cat1,cat3&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_process_all_auto</span><span class="p">(</span><span class="n">cat1</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">num_threads</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">low_mem</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">cat3</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_process_all_cross12</span><span class="p">(</span><span class="n">cat1</span><span class="p">,</span> <span class="n">cat2</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">num_threads</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">low_mem</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_process_all_cross</span><span class="p">(</span><span class="n">cat1</span><span class="p">,</span> <span class="n">cat2</span><span class="p">,</span> <span class="n">cat3</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">num_threads</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">low_mem</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">finalize</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cat2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">varg1</span> <span class="o">=</span> <span class="n">calculateVarG</span><span class="p">(</span><span class="n">cat1</span><span class="p">,</span> <span class="n">low_mem</span><span class="o">=</span><span class="n">low_mem</span><span class="p">)</span>
                <span class="n">varg2</span> <span class="o">=</span> <span class="n">varg1</span>
                <span class="n">varg3</span> <span class="o">=</span> <span class="n">varg1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;varg = </span><span class="si">%f</span><span class="s2">: sig_g = </span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">varg1</span><span class="p">,</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">varg1</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">cat3</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">varg1</span> <span class="o">=</span> <span class="n">calculateVarG</span><span class="p">(</span><span class="n">cat1</span><span class="p">,</span> <span class="n">low_mem</span><span class="o">=</span><span class="n">low_mem</span><span class="p">)</span>
                <span class="n">varg2</span> <span class="o">=</span> <span class="n">calculateVarG</span><span class="p">(</span><span class="n">cat2</span><span class="p">,</span> <span class="n">low_mem</span><span class="o">=</span><span class="n">low_mem</span><span class="p">)</span>
                <span class="n">varg3</span> <span class="o">=</span> <span class="n">varg2</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;varg1 = </span><span class="si">%f</span><span class="s2">: sig_g = </span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">varg1</span><span class="p">,</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">varg1</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;varg2 = </span><span class="si">%f</span><span class="s2">: sig_g = </span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">varg2</span><span class="p">,</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">varg2</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">varg1</span> <span class="o">=</span> <span class="n">calculateVarG</span><span class="p">(</span><span class="n">cat1</span><span class="p">,</span> <span class="n">low_mem</span><span class="o">=</span><span class="n">low_mem</span><span class="p">)</span>
                <span class="n">varg2</span> <span class="o">=</span> <span class="n">calculateVarG</span><span class="p">(</span><span class="n">cat2</span><span class="p">,</span> <span class="n">low_mem</span><span class="o">=</span><span class="n">low_mem</span><span class="p">)</span>
                <span class="n">varg3</span> <span class="o">=</span> <span class="n">calculateVarG</span><span class="p">(</span><span class="n">cat3</span><span class="p">,</span> <span class="n">low_mem</span><span class="o">=</span><span class="n">low_mem</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;varg1 = </span><span class="si">%f</span><span class="s2">: sig_g = </span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">varg1</span><span class="p">,</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">varg1</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;varg2 = </span><span class="si">%f</span><span class="s2">: sig_g = </span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">varg2</span><span class="p">,</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">varg2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;varg3 = </span><span class="si">%f</span><span class="s2">: sig_g = </span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">varg3</span><span class="p">,</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">varg3</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="n">varg1</span><span class="p">,</span><span class="n">varg2</span><span class="p">,</span><span class="n">varg3</span><span class="p">)</span></div>

<div class="viewcode-block" id="GGGCorrelation.getStat"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCorrelation.getStat">[docs]</a>    <span class="k">def</span> <span class="nf">getStat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The standard statistic for the current correlation object as a 1-d array.</span>

<span class="sd">        In this case, the concatenation of gam0.ravel(), gam1.ravel(), gam2.ravel(), gam3.ravel().</span>

<span class="sd">        .. note::</span>

<span class="sd">            This is a complex array, unlike most other statistics.</span>
<span class="sd">            The computed covariance matrix will be complex, although since it is Hermitian the</span>
<span class="sd">            diagonal is real, so the resulting vargam0, etc. will all be real arrays.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">gam0</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">gam1</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">gam2</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">gam3</span><span class="o">.</span><span class="n">ravel</span><span class="p">()])</span></div>

<div class="viewcode-block" id="GGGCorrelation.getWeight"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCorrelation.getWeight">[docs]</a>    <span class="k">def</span> <span class="nf">getWeight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The weight array for the current correlation object as a 1-d array.</span>

<span class="sd">        In this case, 4 copies of self.weight.ravel().</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">ravel</span><span class="p">()]</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span></div>

<div class="viewcode-block" id="GGGCorrelation.write"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCorrelation.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Write the correlation function to the file, file_name.</span>

<span class="sd">        As described in the doc string for `GGGCorrelation`, we use the &quot;natural components&quot; of</span>
<span class="sd">        the shear 3-point function described by Schneider &amp; Lombardi (2003) using the triangle</span>
<span class="sd">        centroid as the projection point.  There are 4 complex-valued natural components, so there</span>
<span class="sd">        are 8 columns in the output file.</span>

<span class="sd">        The output file will include the following columns:</span>

<span class="sd">        ==========      =============================================================</span>
<span class="sd">        Column          Description</span>
<span class="sd">        ==========      =============================================================</span>
<span class="sd">        r_nom           The nominal center of the bin in r = d2 where d1 &gt; d2 &gt; d3</span>
<span class="sd">        u_nom           The nominal center of the bin in u = d3/d2</span>
<span class="sd">        v_nom           The nominal center of the bin in v = +-(d1-d2)/d3</span>
<span class="sd">        meand1          The mean value :math:`\langle d1\rangle` of triangles that</span>
<span class="sd">                        fell into each bin</span>
<span class="sd">        meanlogd1       The mean value :math:`\langle \log(d1)\rangle` of triangles</span>
<span class="sd">                        that fell into each bin</span>
<span class="sd">        meand2          The mean value :math:`\langle d2\rangle` of triangles that</span>
<span class="sd">                        fell into each bin</span>
<span class="sd">        meanlogd2       The mean value :math:`\langle \log(d2)\rangle` of triangles</span>
<span class="sd">                        that fell into each bin</span>
<span class="sd">        meand3          The mean value :math:`\langle d3\rangle` of triangles that</span>
<span class="sd">                        fell into each bin</span>
<span class="sd">        meanlogd3       The mean value :math:`\langle \log(d3)\rangle` of triangles</span>
<span class="sd">                        that fell into each bin</span>
<span class="sd">        meanu           The mean value :math:`\langle u\rangle` of triangles that</span>
<span class="sd">                        fell into each bin</span>
<span class="sd">        meanv           The mean value :math:`\langle v\rangle` of triangles that</span>
<span class="sd">                        fell into each bi.</span>
<span class="sd">        gam0r           The real part of the estimator of :math:`\Gamma_0(r,u,v)`</span>
<span class="sd">        gam0i           The imag part of the estimator of :math:`\Gamma_0(r,u,v)`</span>
<span class="sd">        gam1r           The real part of the estimator of :math:`\Gamma_1(r,u,v)`</span>
<span class="sd">        gam1i           The imag part of the estimator of :math:`\Gamma_1(r,u,v)`</span>
<span class="sd">        gam2r           The real part of the estimator of :math:`\Gamma_2(r,u,v)`</span>
<span class="sd">        gam2i           The imag part of the estimator of :math:`\Gamma_2(r,u,v)`</span>
<span class="sd">        gam3r           The real part of the estimator of :math:`\Gamma_3(r,u,v)`</span>
<span class="sd">        gam3i           The imag part of the estimator of :math:`\Gamma_3(r,u,v)`</span>
<span class="sd">        sigma_gam0      The sqrt of the variance estimate of :math:`\Gamma_0`</span>
<span class="sd">        sigma_gam1      The sqrt of the variance estimate of :math:`\Gamma_1`</span>
<span class="sd">        sigma_gam2      The sqrt of the variance estimate of :math:`\Gamma_2`</span>
<span class="sd">        sigma_gam3      The sqrt of the variance estimate of :math:`\Gamma_3`</span>
<span class="sd">        weight          The total weight of triangles contributing to each bin.</span>
<span class="sd">        ntri            The number of triangles contributing to each bin.</span>
<span class="sd">        ==========      =============================================================</span>

<span class="sd">        If ``sep_units`` was given at construction, then the distances will all be in these units.</span>
<span class="sd">        Otherwise, they will be in either the same units as x,y,z (for flat or 3d coordinates) or</span>
<span class="sd">        radians (for spherical coordinates).</span>

<span class="sd">        Parameters:</span>
<span class="sd">            file_name (str):    The name of the file to write to.</span>
<span class="sd">            file_type (str):    The type of file to write (&#39;ASCII&#39; or &#39;FITS&#39;).  (default: determine</span>
<span class="sd">                                the type automatically from the extension of file_name.)</span>
<span class="sd">            precision (int):    For ASCII output catalogs, the desired precision. (default: 4;</span>
<span class="sd">                                this value can also be given in the constructor in the config dict.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Writing GGG correlations to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">file_name</span><span class="p">)</span>

        <span class="n">col_names</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;r_nom&#39;</span><span class="p">,</span> <span class="s1">&#39;u_nom&#39;</span><span class="p">,</span> <span class="s1">&#39;v_nom&#39;</span><span class="p">,</span> <span class="s1">&#39;meand1&#39;</span><span class="p">,</span> <span class="s1">&#39;meanlogd1&#39;</span><span class="p">,</span> <span class="s1">&#39;meand2&#39;</span><span class="p">,</span> <span class="s1">&#39;meanlogd2&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;meand3&#39;</span><span class="p">,</span> <span class="s1">&#39;meanlogd3&#39;</span><span class="p">,</span> <span class="s1">&#39;meanu&#39;</span><span class="p">,</span> <span class="s1">&#39;meanv&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;gam0r&#39;</span><span class="p">,</span> <span class="s1">&#39;gam0i&#39;</span><span class="p">,</span> <span class="s1">&#39;gam1r&#39;</span><span class="p">,</span> <span class="s1">&#39;gam1i&#39;</span><span class="p">,</span> <span class="s1">&#39;gam2r&#39;</span><span class="p">,</span> <span class="s1">&#39;gam2i&#39;</span><span class="p">,</span> <span class="s1">&#39;gam3r&#39;</span><span class="p">,</span> <span class="s1">&#39;gam3i&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;sigma_gam0&#39;</span><span class="p">,</span> <span class="s1">&#39;sigma_gam1&#39;</span><span class="p">,</span> <span class="s1">&#39;sigma_gam2&#39;</span><span class="p">,</span> <span class="s1">&#39;sigma_gam3&#39;</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">,</span> <span class="s1">&#39;ntri&#39;</span> <span class="p">]</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">meand1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">meanlogd1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">meand2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">meanlogd2</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">meand3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">meanlogd3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">meanu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">meanv</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gam0r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gam0i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gam1r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gam1i</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gam2r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gam2i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gam3r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gam3i</span><span class="p">,</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vargam0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vargam1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vargam2</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vargam3</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ntri</span> <span class="p">]</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;coords&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="s1">&#39;metric&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">metric</span><span class="p">,</span>
                   <span class="s1">&#39;sep_units&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sep_units</span><span class="p">,</span> <span class="s1">&#39;bin_type&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin_type</span> <span class="p">}</span>

        <span class="k">if</span> <span class="n">precision</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">precision</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;precision&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

        <span class="n">gen_write</span><span class="p">(</span>
            <span class="n">file_name</span><span class="p">,</span> <span class="n">col_names</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="n">file_type</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span></div>

<div class="viewcode-block" id="GGGCorrelation.read"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCorrelation.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read in values from a file.</span>

<span class="sd">        This should be a file that was written by TreeCorr, preferably a FITS file, so there</span>
<span class="sd">        is no loss of information.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            The `GGGCorrelation` object should be constructed with the same configuration</span>
<span class="sd">            parameters as the one being read.  e.g. the same min_sep, max_sep, etc.  This is not</span>
<span class="sd">            checked by the read function.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            file_name (str):    The name of the file to read in.</span>
<span class="sd">            file_type (str):    The type of file (&#39;ASCII&#39; or &#39;FITS&#39;).  (default: determine the type</span>
<span class="sd">                                automatically from the extension of file_name.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Reading GGG correlations from </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">file_name</span><span class="p">)</span>

        <span class="n">data</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">gen_read</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="n">file_type</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logr</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">if</span> <span class="s1">&#39;R_nom&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ro</span><span class="o">.</span><span class="n">rnom</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;R_nom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ro</span><span class="o">.</span><span class="n">rnom</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;r_nom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ro</span><span class="o">.</span><span class="n">logr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rnom</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ro</span><span class="o">.</span><span class="n">u</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;u_nom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ro</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;v_nom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meand1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;meand1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanlogd1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;meanlogd1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meand2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;meand2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanlogd2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;meanlogd2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meand3</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;meand3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanlogd3</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;meanlogd3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanu</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;meanu&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanv</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;meanv&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam0r</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;gam0r&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam0i</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;gam0i&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam1r</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;gam1r&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam1i</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;gam1i&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam2r</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;gam2r&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam2i</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;gam2i&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam3r</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;gam3r&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam3i</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;gam3i&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="c1"># Read old output files without error.</span>
        <span class="k">if</span> <span class="s1">&#39;sigma_gam&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vargam0</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sigma_gam&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vargam1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sigma_gam&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vargam2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sigma_gam&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vargam3</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sigma_gam&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vargam0</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sigma_gam0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vargam1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sigma_gam1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vargam2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sigma_gam2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vargam3</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sigma_gam3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ntri</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;ntri&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coords</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;coords&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metric</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;metric&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ro</span><span class="o">.</span><span class="n">sep_units</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;sep_units&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ro</span><span class="o">.</span><span class="n">bin_type</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;bin_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span></div>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_calculateT</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">k3</span><span class="p">):</span>
        <span class="c1"># First calculate q values:</span>
        <span class="n">q1</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="o">+</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="mf">3.</span>
        <span class="n">q2</span> <span class="o">=</span> <span class="n">q1</span><span class="o">-</span><span class="n">t</span>
        <span class="n">q3</span> <span class="o">=</span> <span class="n">q1</span><span class="o">-</span><span class="n">s</span>

        <span class="c1"># |qi|^2 shows up a lot, so save these.</span>
        <span class="c1"># The a stands for &quot;absolute&quot;, and the ^2 part is implicit.</span>
        <span class="n">a1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">a2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">a3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">a123</span> <span class="o">=</span> <span class="n">a1</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">a3</span>

        <span class="c1"># These combinations also appear multiple times.</span>
        <span class="c1"># The b doesn&#39;t stand for anything.  It&#39;s just the next letter after a.</span>
        <span class="n">b1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">q2</span><span class="o">*</span><span class="n">q3</span>
        <span class="n">b2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">q1</span><span class="o">*</span><span class="n">q3</span>
        <span class="n">b3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">q1</span><span class="o">*</span><span class="n">q2</span>

        <span class="k">if</span> <span class="n">k1</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">k2</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">k3</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>

            <span class="c1"># Some factors we use multiple times</span>
            <span class="n">expfactor</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">a1</span> <span class="o">+</span> <span class="n">a2</span> <span class="o">+</span> <span class="n">a3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

            <span class="c1"># JBJ Equation 51</span>
            <span class="c1"># Note that we actually accumulate the Gammas with a different choice for</span>
            <span class="c1"># alpha_i.  We accumulate the shears relative to the q vectors, not relative to s.</span>
            <span class="c1"># cf. JBJ Equation 41 and footnote 3.  The upshot is that we multiply JBJ&#39;s formulae</span>
            <span class="c1"># be (q1q2q3)^2 / |q1q2q3|^2 for T0 and (q1*q2q3)^2/|q1q2q3|^2 for T1.</span>
            <span class="c1"># Then T0 becomes</span>
            <span class="c1"># T0 = -(|q1 q2 q3|^2)/24 exp(-(|q1|^2+|q2|^2+|q3|^2)/2)</span>
            <span class="n">T0</span> <span class="o">=</span> <span class="n">expfactor</span> <span class="o">*</span> <span class="n">a123</span> <span class="o">/</span> <span class="mi">24</span>

            <span class="c1"># JBJ Equation 52</span>
            <span class="c1"># After the phase adjustment, T1 becomes:</span>
            <span class="c1"># T1 = -[(|q1 q2 q3|^2)/24</span>
            <span class="c1">#        - (q1*^2 q2 q3)/9</span>
            <span class="c1">#        + (q1*^4 q2^2 q3^2 + 2 |q2 q3|^2 q1*^2 q2 q3)/(|q1 q2 q3|^2)/27</span>
            <span class="c1">#       ] exp(-(|q1|^2+|q2|^2+|q3|^2)/2)</span>
            <span class="n">T1</span> <span class="o">=</span> <span class="n">expfactor</span> <span class="o">*</span> <span class="p">(</span><span class="n">a123</span> <span class="o">/</span> <span class="mi">24</span> <span class="o">-</span> <span class="n">b1</span> <span class="o">/</span> <span class="mi">9</span> <span class="o">+</span> <span class="p">(</span><span class="n">b1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">a3</span><span class="o">*</span><span class="n">b1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a123</span> <span class="o">*</span> <span class="mi">27</span><span class="p">))</span>
            <span class="n">T2</span> <span class="o">=</span> <span class="n">expfactor</span> <span class="o">*</span> <span class="p">(</span><span class="n">a123</span> <span class="o">/</span> <span class="mi">24</span> <span class="o">-</span> <span class="n">b2</span> <span class="o">/</span> <span class="mi">9</span> <span class="o">+</span> <span class="p">(</span><span class="n">b2</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">a1</span><span class="o">*</span><span class="n">a3</span><span class="o">*</span><span class="n">b2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a123</span> <span class="o">*</span> <span class="mi">27</span><span class="p">))</span>
            <span class="n">T3</span> <span class="o">=</span> <span class="n">expfactor</span> <span class="o">*</span> <span class="p">(</span><span class="n">a123</span> <span class="o">/</span> <span class="mi">24</span> <span class="o">-</span> <span class="n">b3</span> <span class="o">/</span> <span class="mi">9</span> <span class="o">+</span> <span class="p">(</span><span class="n">b3</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">a1</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b3</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a123</span> <span class="o">*</span> <span class="mi">27</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># SKL Equation 63:</span>
            <span class="n">k1sq</span> <span class="o">=</span> <span class="n">k1</span><span class="o">*</span><span class="n">k1</span>
            <span class="n">k2sq</span> <span class="o">=</span> <span class="n">k2</span><span class="o">*</span><span class="n">k2</span>
            <span class="n">k3sq</span> <span class="o">=</span> <span class="n">k3</span><span class="o">*</span><span class="n">k3</span>
            <span class="n">Theta2</span> <span class="o">=</span> <span class="p">((</span><span class="n">k1sq</span><span class="o">*</span><span class="n">k2sq</span> <span class="o">+</span> <span class="n">k1sq</span><span class="o">*</span><span class="n">k3sq</span> <span class="o">+</span> <span class="n">k2sq</span><span class="o">*</span><span class="n">k3sq</span><span class="p">)</span><span class="o">/</span><span class="mf">3.</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
            <span class="n">k1sq</span> <span class="o">/=</span> <span class="n">Theta2</span>   <span class="c1"># These are now what SKL calls theta_i^2 / Theta^2</span>
            <span class="n">k2sq</span> <span class="o">/=</span> <span class="n">Theta2</span>
            <span class="n">k3sq</span> <span class="o">/=</span> <span class="n">Theta2</span>
            <span class="n">Theta4</span> <span class="o">=</span> <span class="n">Theta2</span><span class="o">*</span><span class="n">Theta2</span>
            <span class="n">Theta6</span> <span class="o">=</span> <span class="n">Theta4</span><span class="o">*</span><span class="n">Theta2</span>
            <span class="n">S</span> <span class="o">=</span> <span class="n">k1sq</span> <span class="o">*</span> <span class="n">k2sq</span> <span class="o">*</span> <span class="n">k3sq</span>

            <span class="c1"># SKL Equation 64:</span>
            <span class="n">Z</span> <span class="o">=</span> <span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">k2sq</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k3sq</span> <span class="o">-</span> <span class="n">k1sq</span><span class="p">)</span> <span class="o">*</span> <span class="n">a1</span> <span class="o">+</span>
                 <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">k3sq</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k1sq</span> <span class="o">-</span> <span class="n">k2sq</span><span class="p">)</span> <span class="o">*</span> <span class="n">a2</span> <span class="o">+</span>
                 <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">k1sq</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k2sq</span> <span class="o">-</span> <span class="n">k3sq</span><span class="p">)</span> <span class="o">*</span> <span class="n">a3</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="n">Theta2</span><span class="p">)</span>
            <span class="n">expfactor</span> <span class="o">=</span> <span class="o">-</span><span class="n">S</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">Z</span><span class="p">)</span> <span class="o">/</span> <span class="n">Theta4</span>

            <span class="c1"># SKL Equation 65:</span>
            <span class="n">f1</span> <span class="o">=</span> <span class="p">(</span><span class="n">k2sq</span><span class="o">+</span><span class="n">k3sq</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">k2sq</span><span class="o">-</span><span class="n">k3sq</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q2</span><span class="o">-</span><span class="n">q3</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="n">q1</span><span class="p">)</span>
            <span class="n">f2</span> <span class="o">=</span> <span class="p">(</span><span class="n">k3sq</span><span class="o">+</span><span class="n">k1sq</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">k3sq</span><span class="o">-</span><span class="n">k1sq</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q3</span><span class="o">-</span><span class="n">q1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="n">q2</span><span class="p">)</span>
            <span class="n">f3</span> <span class="o">=</span> <span class="p">(</span><span class="n">k1sq</span><span class="o">+</span><span class="n">k2sq</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">k1sq</span><span class="o">-</span><span class="n">k2sq</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q1</span><span class="o">-</span><span class="n">q2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="n">q3</span><span class="p">)</span>
            <span class="n">f1c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">f1</span><span class="p">)</span>
            <span class="n">f2c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">f2</span><span class="p">)</span>
            <span class="n">f3c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">f3</span><span class="p">)</span>

            <span class="c1"># SKL Equation 69:</span>
            <span class="n">g1</span> <span class="o">=</span> <span class="n">k2sq</span><span class="o">*</span><span class="n">k3sq</span> <span class="o">+</span> <span class="p">(</span><span class="n">k3sq</span><span class="o">-</span><span class="n">k2sq</span><span class="p">)</span><span class="o">*</span><span class="n">k1sq</span><span class="o">*</span><span class="p">(</span><span class="n">q2</span><span class="o">-</span><span class="n">q3</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">q1</span><span class="p">)</span>
            <span class="n">g2</span> <span class="o">=</span> <span class="n">k3sq</span><span class="o">*</span><span class="n">k1sq</span> <span class="o">+</span> <span class="p">(</span><span class="n">k1sq</span><span class="o">-</span><span class="n">k3sq</span><span class="p">)</span><span class="o">*</span><span class="n">k2sq</span><span class="o">*</span><span class="p">(</span><span class="n">q3</span><span class="o">-</span><span class="n">q1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">q2</span><span class="p">)</span>
            <span class="n">g3</span> <span class="o">=</span> <span class="n">k1sq</span><span class="o">*</span><span class="n">k2sq</span> <span class="o">+</span> <span class="p">(</span><span class="n">k2sq</span><span class="o">-</span><span class="n">k1sq</span><span class="p">)</span><span class="o">*</span><span class="n">k3sq</span><span class="o">*</span><span class="p">(</span><span class="n">q1</span><span class="o">-</span><span class="n">q2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">q3</span><span class="p">)</span>
            <span class="n">g1c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">g1</span><span class="p">)</span>
            <span class="n">g2c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">g2</span><span class="p">)</span>
            <span class="n">g3c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">g3</span><span class="p">)</span>

            <span class="c1"># SKL Equation 62:</span>
            <span class="n">T0</span> <span class="o">=</span> <span class="n">expfactor</span> <span class="o">*</span> <span class="n">a123</span> <span class="o">*</span> <span class="n">f1c</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">f2c</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">f3c</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mf">24.</span><span class="o">*</span><span class="n">Theta6</span><span class="p">)</span>

            <span class="c1"># SKL Equation 68:</span>
            <span class="n">T1</span> <span class="o">=</span> <span class="n">expfactor</span> <span class="o">*</span> <span class="p">(</span>
                <span class="n">a123</span> <span class="o">*</span> <span class="n">f1</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">f2c</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">f3c</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">24</span><span class="o">*</span><span class="n">Theta6</span><span class="p">)</span> <span class="o">-</span>
                <span class="n">b1</span> <span class="o">*</span> <span class="n">f1</span><span class="o">*</span><span class="n">f2c</span><span class="o">*</span><span class="n">f3c</span><span class="o">*</span><span class="n">g1c</span> <span class="o">/</span> <span class="p">(</span><span class="mi">9</span><span class="o">*</span><span class="n">Theta4</span><span class="p">)</span> <span class="o">+</span>
                <span class="p">(</span><span class="n">b1</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">g1c</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k2sq</span><span class="o">*</span><span class="n">k3sq</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">a3</span><span class="o">*</span><span class="n">b1</span> <span class="o">*</span> <span class="n">f2c</span> <span class="o">*</span> <span class="n">f3c</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a123</span> <span class="o">*</span> <span class="mi">27</span><span class="o">*</span><span class="n">Theta2</span><span class="p">))</span>
            <span class="n">T2</span> <span class="o">=</span> <span class="n">expfactor</span> <span class="o">*</span> <span class="p">(</span>
                <span class="n">a123</span> <span class="o">*</span> <span class="n">f1c</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">f2</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">f3c</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">24</span><span class="o">*</span><span class="n">Theta6</span><span class="p">)</span> <span class="o">-</span>
                <span class="n">b2</span> <span class="o">*</span> <span class="n">f1c</span><span class="o">*</span><span class="n">f2</span><span class="o">*</span><span class="n">f3c</span><span class="o">*</span><span class="n">g2c</span> <span class="o">/</span> <span class="p">(</span><span class="mi">9</span><span class="o">*</span><span class="n">Theta4</span><span class="p">)</span> <span class="o">+</span>
                <span class="p">(</span><span class="n">b2</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">g2c</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k1sq</span><span class="o">*</span><span class="n">k3sq</span><span class="o">*</span><span class="n">a1</span><span class="o">*</span><span class="n">a3</span><span class="o">*</span><span class="n">b2</span> <span class="o">*</span> <span class="n">f1c</span> <span class="o">*</span> <span class="n">f3c</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a123</span> <span class="o">*</span> <span class="mi">27</span><span class="o">*</span><span class="n">Theta2</span><span class="p">))</span>
            <span class="n">T3</span> <span class="o">=</span> <span class="n">expfactor</span> <span class="o">*</span> <span class="p">(</span>
                <span class="n">a123</span> <span class="o">*</span> <span class="n">f1c</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">f2c</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">f3</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">24</span><span class="o">*</span><span class="n">Theta6</span><span class="p">)</span> <span class="o">-</span>
                <span class="n">b3</span> <span class="o">*</span> <span class="n">f1c</span><span class="o">*</span><span class="n">f2c</span><span class="o">*</span><span class="n">f3</span><span class="o">*</span><span class="n">g3c</span> <span class="o">/</span> <span class="p">(</span><span class="mi">9</span><span class="o">*</span><span class="n">Theta4</span><span class="p">)</span> <span class="o">+</span>
                <span class="p">(</span><span class="n">b3</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">g3c</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k1sq</span><span class="o">*</span><span class="n">k2sq</span><span class="o">*</span><span class="n">a1</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b3</span> <span class="o">*</span> <span class="n">f1c</span> <span class="o">*</span> <span class="n">f2c</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a123</span> <span class="o">*</span> <span class="mi">27</span><span class="o">*</span><span class="n">Theta2</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">T0</span><span class="p">,</span> <span class="n">T1</span><span class="p">,</span> <span class="n">T2</span><span class="p">,</span> <span class="n">T3</span>

<div class="viewcode-block" id="GGGCorrelation.calculateMap3"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCorrelation.calculateMap3">[docs]</a>    <span class="k">def</span> <span class="nf">calculateMap3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">k2</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">k3</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the skewness of the aperture mass from the correlation function.</span>

<span class="sd">        The equations for this come from Jarvis, Bernstein &amp; Jain (2004, MNRAS, 352).</span>
<span class="sd">        See their section 3, especially equations 51 and 52 for the :math:`T_i` functions,</span>
<span class="sd">        equations 60 and 61 for the calculation of :math:`\langle \cal M^3 \rangle` and</span>
<span class="sd">        :math:`\langle \cal M^2 M^* \rangle`, and equations 55-58 for how to convert</span>
<span class="sd">        these to the return values.</span>

<span class="sd">        If k2 or k3 != 1, then this routine calculates the generalization of the skewness</span>
<span class="sd">        proposed by Schneider, Kilbinger &amp; Lombardi (2005, A&amp;A, 431):</span>
<span class="sd">        :math:`\langle M_{ap}^3(R, k_2 R, k_3 R)\rangle` and related values.</span>

<span class="sd">        If k2 = k3 = 1 (the default), then there are only 4 combinations of Map and Mx</span>
<span class="sd">        that are relevant:</span>

<span class="sd">        - map3 = :math:`\langle M_{ap}^3(R)\rangle`</span>
<span class="sd">        - map2mx = :math:`\langle M_{ap}^2(R) M_\times(R)\rangle`,</span>
<span class="sd">        - mapmx2 = :math:`\langle M_{ap}(R) M_\times(R)\rangle`</span>
<span class="sd">        - mx3 = :math:`\langle M_{\rm \times}^3(R)\rangle`</span>

<span class="sd">        However, if k2 or k3 != 1, then there are 8 combinations:</span>

<span class="sd">        - map3 = :math:`\langle M_{ap}(R) M_{ap}(k_2 R) M_{ap}(k_3 R)\rangle`</span>
<span class="sd">        - mapmapmx = :math:`\langle M_{ap}(R) M_{ap}(k_2 R) M_\times(k_3 R)\rangle`</span>
<span class="sd">        - mapmxmap = :math:`\langle M_{ap}(R) M_\times(k_2 R) M_{ap}(k_3 R)\rangle`</span>
<span class="sd">        - mxmapmap = :math:`\langle M_\times(R) M_{ap}(k_2 R) M_{ap}(k_3 R)\rangle`</span>
<span class="sd">        - mxmxmap = :math:`\langle M_\times(R) M_\times(k_2 R) M_{ap}(k_3 R)\rangle`</span>
<span class="sd">        - mxmapmx = :math:`\langle M_\times(R) M_{ap}(k_2 R) M_\times(k_3 R)\rangle`</span>
<span class="sd">        - mapmxmx = :math:`\langle M_{ap}(R) M_\times(k_2 R) M_\times(k_3 R)\rangle`</span>
<span class="sd">        - mx3 = :math:`\langle M_\times(R) M_\times(k_2 R) M_\times(k_3 R)\rangle`</span>

<span class="sd">        To accommodate this full generality, we always return all 8 values, along with the</span>
<span class="sd">        estimated variance (which is equal for each), even when k2 = k3 = 1.</span>

<span class="sd">        .. note::</span>

<span class="sd">            The formulae for the ``m2_uform`` = &#39;Schneider&#39; definition of the aperture mass,</span>
<span class="sd">            described in the documentation of `calculateMapSq`, are not known, so that is not an</span>
<span class="sd">            option here.  The calculations here use the definition that corresponds to</span>
<span class="sd">            ``m2_uform`` = &#39;Crittenden&#39;.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            R (array):      The R values at which to calculate the aperture mass statistics.</span>
<span class="sd">                            (default: None, which means use self.rnom1d)</span>
<span class="sd">            k2 (float):     If given, the ratio R2/R1 in the SKL formulae. (default: 1)</span>
<span class="sd">            k3 (float):     If given, the ratio R3/R1 in the SKL formulae. (default: 1)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple containing:</span>

<span class="sd">            - map3 = array of :math:`\langle M_{ap}(R) M_{ap}(k_2 R) M_{ap}(k_3 R)\rangle`</span>
<span class="sd">            - mapmapmx = array of :math:`\langle M_{ap}(R) M_{ap}(k_2 R) M_\times(k_3 R)\rangle`</span>
<span class="sd">            - mapmxmap = array of :math:`\langle M_{ap}(R) M_\times(k_2 R) M_{ap}(k_3 R)\rangle`</span>
<span class="sd">            - mxmapmap = array of :math:`\langle M_\times(R) M_{ap}(k_2 R) M_{ap}(k_3 R)\rangle`</span>
<span class="sd">            - mxmxmap = array of :math:`\langle M_\times(R) M_\times(k_2 R) M_{ap}(k_3 R)\rangle`</span>
<span class="sd">            - mxmapmx = array of :math:`\langle M_\times(R) M_{ap}(k_2 R) M_\times(k_3 R)\rangle`</span>
<span class="sd">            - mapmxmx = array of :math:`\langle M_{ap}(R) M_\times(k_2 R) M_\times(k_3 R)\rangle`</span>
<span class="sd">            - mx3 = array of :math:`\langle M_\times(R) M_\times(k_2 R) M_\times(k_3 R)\rangle`</span>
<span class="sd">            - varmap3 = array of variance estimates of the above values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># As in the calculateMapSq function, we Make s and t matrices, so we can eventually do the</span>
        <span class="c1"># integral by doing a matrix product.</span>
        <span class="k">if</span> <span class="n">R</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnom1d</span>

        <span class="c1"># Pick s = d2, so dlogs is bin_size</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">R</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">meand2</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>

        <span class="c1"># We take t = d3, but we need the x and y components. (relative to s along x axis)</span>
        <span class="c1"># cf. Figure 1 in JBJ.</span>
        <span class="c1"># d1^2 = d2^2 + d3^2 - 2 d2 d3 cos(theta1)</span>
        <span class="c1"># tx = d3 cos(theta1) = (d2^2 + d3^2 - d1^2)/2d2</span>
        <span class="c1"># Simplify this using u=d3/d2 and v=(d1-d2)/d3</span>
        <span class="c1">#    = (d3^2 - (d1+d2)(d1-d2)) / 2d2</span>
        <span class="c1">#    = d3 (d3 - (d1+d2)v) / 2d2</span>
        <span class="c1">#    = d3 (u - (2+uv)v)/2</span>
        <span class="c1">#    = d3 (u - 2v - uv^2)/2</span>
        <span class="c1">#    = d3 (u(1-v^2)/2 - v)</span>
        <span class="c1"># Note that v here is really |v|.  We&#39;ll account for the sign of v in ty.</span>
        <span class="n">d3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">R</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">meand3</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
        <span class="n">d1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">R</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">meand1</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
        <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meanu</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meanv</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">tx</span> <span class="o">=</span> <span class="n">d3</span><span class="o">*</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">u</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
        <span class="c1"># This form tends to be more stable near potentially degenerate triangles</span>
        <span class="c1"># than tx = (d2*d2 + d3*d3 - d1*d1) / (2*d2)</span>
        <span class="c1"># However, add a check to make sure.</span>
        <span class="n">bad</span> <span class="o">=</span> <span class="p">(</span><span class="n">tx</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="n">d3</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">tx</span> <span class="o">&gt;=</span> <span class="n">d3</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">bad</span><span class="p">):</span>  <span class="c1"># pragma: no cover</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Warning: Detected some invalid triangles when computing Map^3&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Excluding these triangles from the integral.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;N bad points = </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">bad</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;d1[bad] = </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">d1</span><span class="p">[</span><span class="n">bad</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;d2[bad] = </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">d2</span><span class="p">[</span><span class="n">bad</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;d3[bad] = </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">d3</span><span class="p">[</span><span class="n">bad</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;u[bad] = </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">u</span><span class="p">[</span><span class="n">bad</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;v[bad] = </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">v</span><span class="p">[</span><span class="n">bad</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;tx[bad] = </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">tx</span><span class="p">[</span><span class="n">bad</span><span class="p">])</span>
        <span class="n">bad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">bad</span><span class="p">)</span>
        <span class="n">tx</span><span class="p">[</span><span class="n">bad</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># for now to avoid nans</span>
        <span class="n">ty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">d3</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">tx</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ty</span><span class="p">[:,</span><span class="bp">self</span><span class="o">.</span><span class="n">meanv</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mf">1.</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">tx</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">ty</span>

        <span class="c1"># Next we need to construct the T values.</span>
        <span class="n">T0</span><span class="p">,</span> <span class="n">T1</span><span class="p">,</span> <span class="n">T2</span><span class="p">,</span> <span class="n">T3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculateT</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="n">k2</span><span class="p">,</span><span class="n">k3</span><span class="p">)</span>

        <span class="c1"># Finally, account for the Jacobian in d^2t: jac = |J(tx, ty; u, v)|,</span>
        <span class="c1"># since our Gammas are accumulated in s, u, v, not s, tx, ty.</span>
        <span class="c1"># u = d3/d2, v = (d1-d2)/d3</span>
        <span class="c1"># tx = d3 (u - 2v - uv^2)/2</span>
        <span class="c1">#    = s/2 (u^2 - 2uv - u^2v^2)</span>
        <span class="c1"># dtx/du = s (u - v - uv^2)</span>
        <span class="c1"># dtx/dv = -us (1 + uv)</span>
        <span class="c1"># ty = sqrt(d3^2 - tx^2) = sqrt(u^2 s^2 - tx^2)</span>
        <span class="c1"># dty/du = s^2 u/2ty (1-v^2) (2 + 3uv - u^2 + u^2v^2)</span>
        <span class="c1"># dty/dv = s^2 u^2/2ty (1 + uv) (u - uv^2 - 2uv)</span>
        <span class="c1">#</span>
        <span class="c1"># After some algebra...</span>
        <span class="c1">#</span>
        <span class="c1"># J = s^3 u^2 (1+uv) / ty</span>
        <span class="c1">#   = d3^2 d1 / ty</span>
        <span class="c1">#</span>
        <span class="n">jac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">d3</span><span class="o">*</span><span class="n">d3</span><span class="o">*</span><span class="n">d1</span><span class="o">/</span><span class="n">ty</span><span class="p">)</span>
        <span class="n">jac</span><span class="p">[</span><span class="n">bad</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>  <span class="c1"># Exclude any bad triangles from the integral.</span>
        <span class="n">d2t</span> <span class="o">=</span> <span class="n">jac</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ubin_size</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">vbin_size</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">sds</span> <span class="o">=</span> <span class="n">s</span> <span class="o">*</span> <span class="n">s</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin_size</span>  <span class="c1"># Remember bin_size is dln(s)</span>
        <span class="c1"># Note: these are really d2t/2piR^2 and sds/R^2, which are what actually show up</span>
        <span class="c1"># in JBJ equations 45 and 50.</span>

        <span class="n">T0</span> <span class="o">*=</span> <span class="n">sds</span> <span class="o">*</span> <span class="n">d2t</span>
        <span class="n">T1</span> <span class="o">*=</span> <span class="n">sds</span> <span class="o">*</span> <span class="n">d2t</span>
        <span class="n">T2</span> <span class="o">*=</span> <span class="n">sds</span> <span class="o">*</span> <span class="n">d2t</span>
        <span class="n">T3</span> <span class="o">*=</span> <span class="n">sds</span> <span class="o">*</span> <span class="n">d2t</span>

        <span class="c1"># Now do the integral by taking the matrix products.</span>
        <span class="n">gam0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gam0</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">gam1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gam1</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">gam2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gam2</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">gam3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gam3</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">vargam0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vargam0</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">vargam1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vargam1</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">vargam2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vargam2</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">vargam3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vargam3</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">mmm</span> <span class="o">=</span> <span class="n">T0</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">gam0</span><span class="p">)</span>
        <span class="n">mcmm</span> <span class="o">=</span> <span class="n">T1</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">gam1</span><span class="p">)</span>
        <span class="n">mmcm</span> <span class="o">=</span> <span class="n">T2</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">gam2</span><span class="p">)</span>
        <span class="n">mmmc</span> <span class="o">=</span> <span class="n">T3</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">gam3</span><span class="p">)</span>

        <span class="c1"># These accumulate the coefficients that are being dotted to gam0,1,2,3 respectively.</span>
        <span class="c1"># Below, we will take the abs^2 and dot it to gam0,1,2,3 in each case to compute the</span>
        <span class="c1"># total variance.</span>
        <span class="c1"># Note: This assumes that gam0, gam1, gam2, gam3 have no covariance.</span>
        <span class="c1"># This is not technically true, but I think it&#39;s approximately ok.</span>
        <span class="n">var0</span> <span class="o">=</span> <span class="n">T0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">var1</span> <span class="o">=</span> <span class="n">T1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">var2</span> <span class="o">=</span> <span class="n">T2</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">var3</span> <span class="o">=</span> <span class="n">T3</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">k2</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">k3</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">mmm</span> <span class="o">*=</span> <span class="mi">6</span>
            <span class="n">mcmm</span> <span class="o">+=</span> <span class="n">mmcm</span>
            <span class="n">mcmm</span> <span class="o">+=</span> <span class="n">mmmc</span>
            <span class="n">mcmm</span> <span class="o">*=</span> <span class="mi">2</span>
            <span class="n">mmcm</span> <span class="o">=</span> <span class="n">mmmc</span> <span class="o">=</span> <span class="n">mcmm</span>
            <span class="n">var0</span> <span class="o">*=</span> <span class="mi">6</span>
            <span class="n">var1</span> <span class="o">*=</span> <span class="mi">6</span>
            <span class="n">var2</span> <span class="o">*=</span> <span class="mi">6</span>
            <span class="n">var3</span> <span class="o">*=</span> <span class="mi">6</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Repeat the above for the other permutations</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">_k1</span><span class="p">,</span> <span class="n">_k2</span><span class="p">,</span> <span class="n">_k3</span><span class="p">,</span> <span class="n">_mcmm</span><span class="p">,</span> <span class="n">_mmcm</span><span class="p">,</span> <span class="n">_mmmc</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">k3</span><span class="p">,</span><span class="n">k2</span><span class="p">,</span><span class="n">mcmm</span><span class="p">,</span><span class="n">mmmc</span><span class="p">,</span><span class="n">mmcm</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">k2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">k3</span><span class="p">,</span><span class="n">mmcm</span><span class="p">,</span><span class="n">mcmm</span><span class="p">,</span><span class="n">mmmc</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">k2</span><span class="p">,</span><span class="n">k3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">mmcm</span><span class="p">,</span><span class="n">mmmc</span><span class="p">,</span><span class="n">mcmm</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">k3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">k2</span><span class="p">,</span><span class="n">mmmc</span><span class="p">,</span><span class="n">mcmm</span><span class="p">,</span><span class="n">mmcm</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">k3</span><span class="p">,</span><span class="n">k2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">mmmc</span><span class="p">,</span><span class="n">mmcm</span><span class="p">,</span><span class="n">mcmm</span><span class="p">)</span> <span class="p">]:</span>
                <span class="n">T0</span><span class="p">,</span> <span class="n">T1</span><span class="p">,</span> <span class="n">T2</span><span class="p">,</span> <span class="n">T3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculateT</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">_k1</span><span class="p">,</span><span class="n">_k2</span><span class="p">,</span><span class="n">_k3</span><span class="p">)</span>
                <span class="n">T0</span> <span class="o">*=</span> <span class="n">sds</span> <span class="o">*</span> <span class="n">d2t</span>
                <span class="n">T1</span> <span class="o">*=</span> <span class="n">sds</span> <span class="o">*</span> <span class="n">d2t</span>
                <span class="n">T2</span> <span class="o">*=</span> <span class="n">sds</span> <span class="o">*</span> <span class="n">d2t</span>
                <span class="n">T3</span> <span class="o">*=</span> <span class="n">sds</span> <span class="o">*</span> <span class="n">d2t</span>
                <span class="c1"># Relies on numpy array overloading += to actually update in place.</span>
                <span class="n">mmm</span> <span class="o">+=</span> <span class="n">T0</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">gam0</span><span class="p">)</span>
                <span class="n">_mcmm</span> <span class="o">+=</span> <span class="n">T1</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">gam1</span><span class="p">)</span>
                <span class="n">_mmcm</span> <span class="o">+=</span> <span class="n">T2</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">gam2</span><span class="p">)</span>
                <span class="n">_mmmc</span> <span class="o">+=</span> <span class="n">T3</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">gam3</span><span class="p">)</span>
                <span class="n">var0</span> <span class="o">+=</span> <span class="n">T0</span>
                <span class="n">var1</span> <span class="o">+=</span> <span class="n">T1</span>
                <span class="n">var2</span> <span class="o">+=</span> <span class="n">T2</span>
                <span class="n">var3</span> <span class="o">+=</span> <span class="n">T3</span>

        <span class="n">map3</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">mcmm</span> <span class="o">+</span> <span class="n">mmcm</span> <span class="o">+</span> <span class="n">mmmc</span> <span class="o">+</span> <span class="n">mmm</span><span class="p">)</span>
        <span class="n">mapmapmx</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">mcmm</span> <span class="o">+</span> <span class="n">mmcm</span> <span class="o">-</span> <span class="n">mmmc</span> <span class="o">+</span> <span class="n">mmm</span><span class="p">)</span>
        <span class="n">mapmxmap</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">mcmm</span> <span class="o">-</span> <span class="n">mmcm</span> <span class="o">+</span> <span class="n">mmmc</span> <span class="o">+</span> <span class="n">mmm</span><span class="p">)</span>
        <span class="n">mxmapmap</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="o">-</span><span class="n">mcmm</span> <span class="o">+</span> <span class="n">mmcm</span> <span class="o">+</span> <span class="n">mmmc</span> <span class="o">+</span> <span class="n">mmm</span><span class="p">)</span>
        <span class="n">mxmxmap</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">mcmm</span> <span class="o">+</span> <span class="n">mmcm</span> <span class="o">-</span> <span class="n">mmmc</span> <span class="o">-</span> <span class="n">mmm</span><span class="p">)</span>
        <span class="n">mxmapmx</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">mcmm</span> <span class="o">-</span> <span class="n">mmcm</span> <span class="o">+</span> <span class="n">mmmc</span> <span class="o">-</span> <span class="n">mmm</span><span class="p">)</span>
        <span class="n">mapmxmx</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="o">-</span><span class="n">mcmm</span> <span class="o">+</span> <span class="n">mmcm</span> <span class="o">+</span> <span class="n">mmmc</span> <span class="o">-</span> <span class="n">mmm</span><span class="p">)</span>
        <span class="n">mx3</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">mcmm</span> <span class="o">+</span> <span class="n">mmcm</span> <span class="o">+</span> <span class="n">mmmc</span> <span class="o">-</span> <span class="n">mmm</span><span class="p">)</span>

        <span class="n">var0</span> <span class="o">/=</span> <span class="mi">4</span>
        <span class="n">var1</span> <span class="o">/=</span> <span class="mi">4</span>
        <span class="n">var2</span> <span class="o">/=</span> <span class="mi">4</span>
        <span class="n">var3</span> <span class="o">/=</span> <span class="mi">4</span>

        <span class="c1"># Now finally add up the coefficient squared times each vargam element.</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">var0</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vargam0</span><span class="p">)</span>
        <span class="n">var</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">var1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vargam1</span><span class="p">)</span>
        <span class="n">var</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">var2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vargam2</span><span class="p">)</span>
        <span class="n">var</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">var3</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vargam3</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">map3</span><span class="p">,</span> <span class="n">mapmapmx</span><span class="p">,</span> <span class="n">mapmxmap</span><span class="p">,</span> <span class="n">mxmapmap</span><span class="p">,</span> <span class="n">mxmxmap</span><span class="p">,</span> <span class="n">mxmapmx</span><span class="p">,</span> <span class="n">mapmxmx</span><span class="p">,</span> <span class="n">mx3</span><span class="p">,</span> <span class="n">var</span></div>

<div class="viewcode-block" id="GGGCorrelation.writeMap3"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCorrelation.writeMap3">[docs]</a>    <span class="k">def</span> <span class="nf">writeMap3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Write the aperture mass skewness based on the correlation function to the</span>
<span class="sd">        file, file_name.</span>

<span class="sd">        The output file will include the following columns:</span>

<span class="sd">        ==========      ==========================================================</span>
<span class="sd">        Column          Description</span>
<span class="sd">        ==========      ==========================================================</span>
<span class="sd">        R               The aperture radius</span>
<span class="sd">        Map3            An estimate of :math:`\langle M_{ap}^3\rangle(R)`</span>
<span class="sd">                        (cf. `calculateMap3`)</span>
<span class="sd">        Map2Mx          An estimate of :math:`\langle M_{ap}^2 M_\times\rangle(R)`</span>
<span class="sd">        MapMx2          An estimate of :math:`\langle M_{ap} M_\times^2\rangle(R)`</span>
<span class="sd">        Mx3             An estimate of :math:`\langle M_\times^3\rangle(R)`</span>
<span class="sd">        sig_map         The sqrt of the variance estimate of each of these</span>
<span class="sd">        ==========      ==========================================================</span>

<span class="sd">        Parameters:</span>
<span class="sd">            file_name (str):    The name of the file to write to.</span>
<span class="sd">            R (array):          The R values at which to calculate the statistics.</span>
<span class="sd">                                (default: None, which means use self.rnom)</span>
<span class="sd">            file_type (str):    The type of file to write (&#39;ASCII&#39; or &#39;FITS&#39;).  (default: determine</span>
<span class="sd">                                the type automatically from the extension of file_name.)</span>
<span class="sd">            precision (int):    For ASCII output catalogs, the desired precision. (default: 4;</span>
<span class="sd">                                this value can also be given in the constructor in the config dict.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Writing Map^3 from GGG correlations to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">file_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">R</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnom1d</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculateMap3</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">precision</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">precision</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;precision&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

        <span class="n">gen_write</span><span class="p">(</span>
            <span class="n">file_name</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="s1">&#39;Map3&#39;</span><span class="p">,</span><span class="s1">&#39;Map2Mx&#39;</span><span class="p">,</span> <span class="s1">&#39;MapMx2&#39;</span><span class="p">,</span> <span class="s1">&#39;Mx3&#39;</span><span class="p">,</span><span class="s1">&#39;sig_map&#39;</span><span class="p">],</span>
            <span class="p">[</span> <span class="n">R</span><span class="p">,</span> <span class="n">stats</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">stats</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">stats</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">stats</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span> <span class="p">],</span>
            <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="n">file_type</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="GGGCrossCorrelation"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCrossCorrelation">[docs]</a><span class="k">class</span> <span class="nc">GGGCrossCorrelation</span><span class="p">(</span><span class="n">BinnedCorr3</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;This class handles the calculation a 3-point shear-shear-shear cross-correlation</span>
<span class="sd">    function.</span>

<span class="sd">    For 3-point cross correlations, it matters which of the two or three fields falls on</span>
<span class="sd">    each corner of the triangle.  E.g. is field 1 on the corner opposite d1 (the longest</span>
<span class="sd">    size of the triangle) or is it field 2 (or 3) there?  This is in contrast to the 2-point</span>
<span class="sd">    correlation where the symmetry of the situation means that it doesn&#39;t matter which point</span>
<span class="sd">    is identified with each field.  This makes it significantly more complicated to keep track</span>
<span class="sd">    of all the relevant information for a 3-point cross correlation function.</span>

<span class="sd">    The `GGGCorrelation` class holds a single set of :math:`\Gamma` functions describing all</span>
<span class="sd">    possible triangles, parameterized according to their relative side lengths ordered as</span>
<span class="sd">    d1 &gt; d2 &gt; d3.</span>

<span class="sd">    For a cross-correlation of two fields: G1 - G1 - G2 (i.e. the G1 field is at two of the</span>
<span class="sd">    corners and G2 is at one corner), then we need three sets of these :math:`\Gamma` functions</span>
<span class="sd">    to capture all of the triangles, since the G2 points may be opposite d1 or d2 or d3.</span>
<span class="sd">    For a cross-correlation of three fields: G1 - G2 - G3, we need six sets, to account for</span>
<span class="sd">    all of the possible permutations relative to the triangle sides.</span>

<span class="sd">    Therefore, this class holds 6 instances of `GGGCorrelation`, which in turn hold the</span>
<span class="sd">    information about triangles in each of the relevant configurations.  We name these:</span>

<span class="sd">    Attributes:</span>
<span class="sd">        g1g2g3:     Triangles where G1 is opposite d1, G2 is opposite d2, G3 is opposite d3.</span>
<span class="sd">        g1g3g2:     Triangles where G1 is opposite d1, G3 is opposite d2, G2 is opposite d3.</span>
<span class="sd">        g2g1g3:     Triangles where G2 is opposite d1, G1 is opposite d2, G3 is opposite d3.</span>
<span class="sd">        g2g3g1:     Triangles where G2 is opposite d1, G3 is opposite d2, G1 is opposite d3.</span>
<span class="sd">        g3g1g2:     Triangles where G3 is opposite d1, G1 is opposite d2, G2 is opposite d3.</span>
<span class="sd">        g3g2g1:     Triangles where G3 is opposite d1, G2 is opposite d2, G1 is opposite d3.</span>

<span class="sd">    If for instance G2 and G3 are the same field, then e.g. g1g2g3 and g1g3g2 will have</span>
<span class="sd">    the same values.</span>

<span class="sd">    Ojects of this class also hold the following attributes, which are identical in each of</span>
<span class="sd">    the above GGGCorrelation instances.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        nbins:      The number of bins in logr where r = d2</span>
<span class="sd">        bin_size:   The size of the bins in logr</span>
<span class="sd">        min_sep:    The minimum separation being considered</span>
<span class="sd">        max_sep:    The maximum separation being considered</span>
<span class="sd">        nubins:     The number of bins in u where u = d3/d2</span>
<span class="sd">        ubin_size:  The size of the bins in u</span>
<span class="sd">        min_u:      The minimum u being considered</span>
<span class="sd">        max_u:      The maximum u being considered</span>
<span class="sd">        nvbins:     The number of bins in v where v = +-(d1-d2)/d3</span>
<span class="sd">        vbin_size:  The size of the bins in v</span>
<span class="sd">        min_v:      The minimum v being considered</span>
<span class="sd">        max_v:      The maximum v being considered</span>
<span class="sd">        logr1d:     The nominal centers of the nbins bins in log(r).</span>
<span class="sd">        u1d:        The nominal centers of the nubins bins in u.</span>
<span class="sd">        v1d:        The nominal centers of the nvbins bins in v.</span>

<span class="sd">    If ``sep_units`` are given (either in the config dict or as a named kwarg) then the distances</span>
<span class="sd">    will all be in these units.</span>

<span class="sd">    .. note::</span>

<span class="sd">        If you separate out the steps of the `process` command and use `process_cross` directly,</span>
<span class="sd">        then the units will not be applied to ``meanr`` or ``meanlogr`` until the `finalize`</span>
<span class="sd">        function is called.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        config (dict):  A configuration dict that can be used to pass in kwargs if desired.</span>
<span class="sd">                        This dict is allowed to have addition entries besides those listed</span>
<span class="sd">                        in `BinnedCorr3`, which are ignored here. (default: None)</span>
<span class="sd">        logger:         If desired, a logger object for logging. (default: None, in which case</span>
<span class="sd">                        one will be built according to the config dict&#39;s verbose level.)</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">        **kwargs:       See the documentation for `BinnedCorr3` for the list of allowed keyword</span>
<span class="sd">                        arguments, which may be passed either directly or in the config dict.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="GGGCrossCorrelation.__init__"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCrossCorrelation.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize `GGGCrossCorrelation`.  See class doc for details.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">BinnedCorr3</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_ro</span><span class="o">.</span><span class="n">_d1</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># GData</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ro</span><span class="o">.</span><span class="n">_d2</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># GData</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ro</span><span class="o">.</span><span class="n">_d3</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># GData</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">g1g2g3</span> <span class="o">=</span> <span class="n">GGGCorrelation</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g1g3g2</span> <span class="o">=</span> <span class="n">GGGCorrelation</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g2g1g3</span> <span class="o">=</span> <span class="n">GGGCorrelation</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g2g3g1</span> <span class="o">=</span> <span class="n">GGGCorrelation</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g3g1g2</span> <span class="o">=</span> <span class="n">GGGCorrelation</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g3g2g1</span> <span class="o">=</span> <span class="n">GGGCorrelation</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_all</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">g1g2g3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g1g3g2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g2g1g3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g2g3g1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g3g1g2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g3g2g1</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Finished building GGGCrossCorr&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="GGGCrossCorrelation.__eq__"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCrossCorrelation.__eq__">[docs]</a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return whether two `GGGCrossCorrelation` instances are equal&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">GGGCrossCorrelation</span><span class="p">)</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nbins</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">nbins</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bin_size</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">bin_size</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">min_sep</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">min_sep</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_sep</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">max_sep</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sep_units</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">sep_units</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">min_u</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">min_u</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_u</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">max_u</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nubins</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">nubins</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ubin_size</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">ubin_size</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">min_v</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">min_v</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_v</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">max_v</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nvbins</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">nvbins</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vbin_size</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">vbin_size</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coords</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">coords</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bin_type</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">bin_type</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bin_slop</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">bin_slop</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">xperiod</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">xperiod</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">yperiod</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">yperiod</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">zperiod</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">zperiod</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">g1g2g3</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">g1g2g3</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">g1g3g2</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">g1g3g2</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">g2g1g3</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">g2g1g3</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">g2g3g1</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">g2g3g1</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">g3g1g2</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">g3g1g2</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">g3g2g1</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">g3g2g1</span><span class="p">)</span></div>

<div class="viewcode-block" id="GGGCrossCorrelation.copy"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCrossCorrelation.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Make a copy&quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">GGGCrossCorrelation</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">GGGCrossCorrelation</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">GGGCorrelation</span><span class="p">):</span>
                <span class="n">ret</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ret</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>
        <span class="c1"># This needs to be the new list:</span>
        <span class="n">ret</span><span class="o">.</span><span class="n">_all</span> <span class="o">=</span> <span class="p">[</span><span class="n">ret</span><span class="o">.</span><span class="n">g1g2g3</span><span class="p">,</span> <span class="n">ret</span><span class="o">.</span><span class="n">g1g3g2</span><span class="p">,</span> <span class="n">ret</span><span class="o">.</span><span class="n">g2g1g3</span><span class="p">,</span> <span class="n">ret</span><span class="o">.</span><span class="n">g2g3g1</span><span class="p">,</span> <span class="n">ret</span><span class="o">.</span><span class="n">g3g1g2</span><span class="p">,</span> <span class="n">ret</span><span class="o">.</span><span class="n">g3g2g1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">ret</span></div>

<div class="viewcode-block" id="GGGCrossCorrelation.__repr__"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCrossCorrelation.__repr__">[docs]</a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;GGGCrossCorrelation(config=</span><span class="si">%r</span><span class="s1">)&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span></div>

<div class="viewcode-block" id="GGGCrossCorrelation.process_cross12"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCrossCorrelation.process_cross12">[docs]</a>    <span class="k">def</span> <span class="nf">process_cross12</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cat1</span><span class="p">,</span> <span class="n">cat2</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_threads</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process two catalogs, accumulating the 3pt cross-correlation, where one of the</span>
<span class="sd">        points in each triangle come from the first catalog, and two come from the second.</span>

<span class="sd">        This accumulates the cross-correlation for the given catalogs.  After</span>
<span class="sd">        calling this function as often as desired, the `finalize` command will</span>
<span class="sd">        finish the calculation of meand1, meanlogd1, etc.</span>

<span class="sd">        .. note::</span>

<span class="sd">            This only adds to the attributes g1g2g3, g2g1g3, g2g3g1, not the ones where</span>
<span class="sd">            3 comes before 2.  When running this via the regular `process` method, it will</span>
<span class="sd">            combine them at the end to make sure g1g2g3 == g1g3g2, etc. for a complete</span>
<span class="sd">            calculation of the 1-2 cross-correlation.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            cat1 (Catalog):     The first catalog to process. (1 point in each triangle will come</span>
<span class="sd">                                from this catalog.)</span>
<span class="sd">            cat2 (Catalog):     The second catalog to process. (2 points in each triangle will come</span>
<span class="sd">                                from this catalog.)</span>
<span class="sd">            metric (str):       Which metric to use.  See `Metrics` for details.</span>
<span class="sd">                                (default: &#39;Euclidean&#39;; this value can also be given in the</span>
<span class="sd">                                constructor in the config dict.)</span>
<span class="sd">            num_threads (int):  How many OpenMP threads to use during the calculation.</span>
<span class="sd">                                (default: use the number of cpu cores; this value can also be given</span>
<span class="sd">                                in the constructor in the config dict.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">cat1</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">cat2</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Starting process GGG (1-2) cross-correlations&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Starting process GGG (1-2) cross-correlations for cats </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">.&#39;</span><span class="p">,</span>
                             <span class="n">cat1</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">cat2</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_metric</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="n">cat1</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="n">cat2</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ggg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all</span><span class="p">:</span>
            <span class="n">ggg</span><span class="o">.</span><span class="n">_set_metric</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metric</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_num_threads</span><span class="p">(</span><span class="n">num_threads</span><span class="p">)</span>
        <span class="n">min_size</span><span class="p">,</span> <span class="n">max_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_minmax_size</span><span class="p">()</span>

        <span class="n">f1</span> <span class="o">=</span> <span class="n">cat1</span><span class="o">.</span><span class="n">getGField</span><span class="p">(</span><span class="n">min_size</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_method</span><span class="p">,</span>
                            <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brute</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
        <span class="n">f2</span> <span class="o">=</span> <span class="n">cat2</span><span class="o">.</span><span class="n">getGField</span><span class="p">(</span><span class="n">min_size</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_method</span><span class="p">,</span>
                            <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brute</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Starting </span><span class="si">%d</span><span class="s1"> jobs.&#39;</span><span class="p">,</span><span class="n">f1</span><span class="o">.</span><span class="n">nTopLevelNodes</span><span class="p">)</span>
        <span class="c1"># Note: all 3 correlation objects are the same.  Thus, all triangles will be placed</span>
        <span class="c1"># into self.corr, whichever way the three catalogs are permuted for each triangle.</span>
        <span class="n">_lib</span><span class="o">.</span><span class="n">ProcessCross12</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g1g2g3</span><span class="o">.</span><span class="n">corr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g2g1g3</span><span class="o">.</span><span class="n">corr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g2g3g1</span><span class="o">.</span><span class="n">corr</span><span class="p">,</span>
                            <span class="n">f1</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">f2</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_dots</span><span class="p">,</span>
                            <span class="n">f1</span><span class="o">.</span><span class="n">_d</span><span class="p">,</span> <span class="n">f2</span><span class="o">.</span><span class="n">_d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coords</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_bintype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metric</span><span class="p">)</span></div>

<div class="viewcode-block" id="GGGCrossCorrelation.process_cross"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCrossCorrelation.process_cross">[docs]</a>    <span class="k">def</span> <span class="nf">process_cross</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cat1</span><span class="p">,</span> <span class="n">cat2</span><span class="p">,</span> <span class="n">cat3</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_threads</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process a set of three catalogs, accumulating the 3pt cross-correlation.</span>

<span class="sd">        This accumulates the cross-correlation for the given catalogs.  After</span>
<span class="sd">        calling this function as often as desired, the `finalize` command will</span>
<span class="sd">        finish the calculation of meand1, meanlogd1, etc.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            cat1 (Catalog):     The first catalog to process</span>
<span class="sd">            cat2 (Catalog):     The second catalog to process</span>
<span class="sd">            cat3 (Catalog):     The third catalog to process</span>
<span class="sd">            metric (str):       Which metric to use.  See `Metrics` for details.</span>
<span class="sd">                                (default: &#39;Euclidean&#39;; this value can also be given in the</span>
<span class="sd">                                constructor in the config dict.)</span>
<span class="sd">            num_threads (int):  How many OpenMP threads to use during the calculation.</span>
<span class="sd">                                (default: use the number of cpu cores; this value can also be given</span>
<span class="sd">                                in the constructor in the config dict.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">cat1</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">cat2</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">cat3</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Starting process GGG cross-correlations&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Starting process GGG cross-correlations for cats </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">.&#39;</span><span class="p">,</span>
                             <span class="n">cat1</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">cat2</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">cat3</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_metric</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="n">cat1</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="n">cat2</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="n">cat3</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ggg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all</span><span class="p">:</span>
            <span class="n">ggg</span><span class="o">.</span><span class="n">_set_metric</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metric</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_num_threads</span><span class="p">(</span><span class="n">num_threads</span><span class="p">)</span>
        <span class="n">min_size</span><span class="p">,</span> <span class="n">max_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_minmax_size</span><span class="p">()</span>

        <span class="n">f1</span> <span class="o">=</span> <span class="n">cat1</span><span class="o">.</span><span class="n">getGField</span><span class="p">(</span><span class="n">min_size</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_method</span><span class="p">,</span>
                            <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brute</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
        <span class="n">f2</span> <span class="o">=</span> <span class="n">cat2</span><span class="o">.</span><span class="n">getGField</span><span class="p">(</span><span class="n">min_size</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_method</span><span class="p">,</span>
                            <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brute</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
        <span class="n">f3</span> <span class="o">=</span> <span class="n">cat3</span><span class="o">.</span><span class="n">getGField</span><span class="p">(</span><span class="n">min_size</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_method</span><span class="p">,</span>
                            <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brute</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Starting </span><span class="si">%d</span><span class="s1"> jobs.&#39;</span><span class="p">,</span><span class="n">f1</span><span class="o">.</span><span class="n">nTopLevelNodes</span><span class="p">)</span>
        <span class="n">_lib</span><span class="o">.</span><span class="n">ProcessCross3</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g1g2g3</span><span class="o">.</span><span class="n">corr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g1g3g2</span><span class="o">.</span><span class="n">corr</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">g2g1g3</span><span class="o">.</span><span class="n">corr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g2g3g1</span><span class="o">.</span><span class="n">corr</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">g3g1g2</span><span class="o">.</span><span class="n">corr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g3g2g1</span><span class="o">.</span><span class="n">corr</span><span class="p">,</span>
                           <span class="n">f1</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">f2</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">f3</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_dots</span><span class="p">,</span>
                           <span class="n">f1</span><span class="o">.</span><span class="n">_d</span><span class="p">,</span> <span class="n">f2</span><span class="o">.</span><span class="n">_d</span><span class="p">,</span> <span class="n">f3</span><span class="o">.</span><span class="n">_d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coords</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bintype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metric</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ggg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all</span><span class="p">:</span>
            <span class="n">ggg</span><span class="o">.</span><span class="n">_finalize</span><span class="p">()</span>

<div class="viewcode-block" id="GGGCrossCorrelation.finalize"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCrossCorrelation.finalize">[docs]</a>    <span class="k">def</span> <span class="nf">finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">varg1</span><span class="p">,</span> <span class="n">varg2</span><span class="p">,</span> <span class="n">varg3</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Finalize the calculation of the correlation function.</span>

<span class="sd">        The `process_cross` command accumulate values in each bin, so they can be called</span>
<span class="sd">        multiple times if appropriate.  Afterwards, this command finishes the calculation</span>
<span class="sd">        by dividing by the total weight.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            varg1 (float):  The shear variance for the first field that was correlated.</span>
<span class="sd">            varg2 (float):  The shear variance for the second field that was correlated.</span>
<span class="sd">            varg3 (float):  The shear variance for the third field that was correlated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g1g2g3</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="n">varg1</span><span class="p">,</span><span class="n">varg2</span><span class="p">,</span><span class="n">varg3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g1g3g2</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="n">varg1</span><span class="p">,</span><span class="n">varg3</span><span class="p">,</span><span class="n">varg2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g2g1g3</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="n">varg2</span><span class="p">,</span><span class="n">varg1</span><span class="p">,</span><span class="n">varg3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g2g3g1</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="n">varg2</span><span class="p">,</span><span class="n">varg3</span><span class="p">,</span><span class="n">varg1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g3g1g2</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="n">varg3</span><span class="p">,</span><span class="n">varg1</span><span class="p">,</span><span class="n">varg2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g3g2g1</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="n">varg3</span><span class="p">,</span><span class="n">varg2</span><span class="p">,</span><span class="n">varg1</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return if there are any values accumulated yet.  (i.e. ntri &gt; 0)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">([</span><span class="n">ggg</span><span class="o">.</span><span class="n">nonzero</span> <span class="k">for</span> <span class="n">ggg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear the data vectors</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">ggg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all</span><span class="p">:</span>
            <span class="n">ggg</span><span class="o">.</span><span class="n">_clear</span><span class="p">()</span>

<div class="viewcode-block" id="GGGCrossCorrelation.__iadd__"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCrossCorrelation.__iadd__">[docs]</a>    <span class="k">def</span> <span class="fm">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a second `GGGCrossCorrelation`&#39;s data to this one.</span>

<span class="sd">        .. note::</span>

<span class="sd">            For this to make sense, both `GGGCrossCorrelation` objects should not have had</span>
<span class="sd">            `finalize` called yet.  Then, after adding them together, you should call `finalize`</span>
<span class="sd">            on the sum.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">GGGCrossCorrelation</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Can only add another GGGCrossCorrelation object&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g1g2g3</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">g1g2g3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g1g3g2</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">g1g3g2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g2g1g3</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">g2g1g3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g2g3g1</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">g2g3g1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g3g1g2</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">g3g1g2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g3g2g1</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">g3g2g1</span>
        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="k">def</span> <span class="nf">_sum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">others</span><span class="p">):</span>
        <span class="c1"># Equivalent to the operation of:</span>
        <span class="c1">#     self._clear()</span>
        <span class="c1">#     for other in others:</span>
        <span class="c1">#         self += other</span>
        <span class="c1"># but no sanity checks and use numpy.sum for faster calculation.</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ggg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_all</span><span class="p">):</span>
            <span class="n">ggg</span><span class="o">.</span><span class="n">_sum</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">_all</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">others</span><span class="p">])</span>

<div class="viewcode-block" id="GGGCrossCorrelation.process"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCrossCorrelation.process">[docs]</a>    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cat1</span><span class="p">,</span> <span class="n">cat2</span><span class="p">,</span> <span class="n">cat3</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_threads</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">comm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">low_mem</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">finalize</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Accumulate the cross-correlation of the points in the given Catalogs: cat1, cat2, cat3.</span>

<span class="sd">        - If 2 arguments are given, then compute a cross-correlation function with the</span>
<span class="sd">          first catalog taking one corner of the triangles, and the second taking two corners.</span>
<span class="sd">        - If 3 arguments are given, then compute a three-way cross-correlation function.</span>

<span class="sd">        All arguments may be lists, in which case all items in the list are used</span>
<span class="sd">        for that element of the correlation.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            cat1 (Catalog):     A catalog or list of catalogs for the first G field.</span>
<span class="sd">            cat2 (Catalog):     A catalog or list of catalogs for the second G field.</span>
<span class="sd">            cat3 (Catalog):     A catalog or list of catalogs for the third G field.</span>
<span class="sd">                                (default: None)</span>
<span class="sd">            metric (str):       Which metric to use.  See `Metrics` for details.</span>
<span class="sd">                                (default: &#39;Euclidean&#39;; this value can also be given in the</span>
<span class="sd">                                constructor in the config dict.)</span>
<span class="sd">            num_threads (int):  How many OpenMP threads to use during the calculation.</span>
<span class="sd">                                (default: use the number of cpu cores; this value can also be given</span>
<span class="sd">                                in the constructor in the config dict.)</span>
<span class="sd">            comm (mpi4py.Comm): If running MPI, an mpi4py Comm object to communicate between</span>
<span class="sd">                                processes.  If used, the rank=0 process will have the final</span>
<span class="sd">                                computation. This only works if using patches. (default: None)</span>
<span class="sd">            low_mem (bool):     Whether to sacrifice a little speed to try to reduce memory usage.</span>
<span class="sd">                                This only works if using patches. (default: False)</span>
<span class="sd">            initialize (bool):  Whether to begin the calculation with a call to</span>
<span class="sd">                                `BinnedCorr3.clear`.  (default: True)</span>
<span class="sd">            finalize (bool):    Whether to complete the calculation with a call to `finalize`.</span>
<span class="sd">                                (default: True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">math</span>
        <span class="k">if</span> <span class="n">initialize</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_process12</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cat1</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span> <span class="n">cat1</span> <span class="o">=</span> <span class="n">cat1</span><span class="o">.</span><span class="n">get_patches</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cat2</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span> <span class="n">cat2</span> <span class="o">=</span> <span class="n">cat2</span><span class="o">.</span><span class="n">get_patches</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">cat3</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cat3</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span> <span class="n">cat3</span> <span class="o">=</span> <span class="n">cat3</span><span class="o">.</span><span class="n">get_patches</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">cat3</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_process12</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_process_all_cross12</span><span class="p">(</span><span class="n">cat1</span><span class="p">,</span> <span class="n">cat2</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">num_threads</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">low_mem</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_process_all_cross</span><span class="p">(</span><span class="n">cat1</span><span class="p">,</span> <span class="n">cat2</span><span class="p">,</span> <span class="n">cat3</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">num_threads</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">low_mem</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">finalize</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process12</span><span class="p">:</span>
                <span class="c1"># Then some of the processing involved a cross12 calculation.</span>
                <span class="c1"># This means that spots 2 and 3 should not be distinguished.</span>
                <span class="c1"># Combine the relevant arrays.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">g1g2g3</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g1g3g2</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">g2g1g3</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g3g1g2</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">g2g3g1</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g3g2g1</span>
                <span class="c1"># Copy back by doing clear and +=.</span>
                <span class="c1"># This makes sure the coords and metric are set properly.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">g1g3g2</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">g3g1g2</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">g3g2g1</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">g1g3g2</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g1g2g3</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">g3g1g2</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g2g1g3</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">g3g2g1</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g2g3g1</span>

            <span class="n">varg1</span> <span class="o">=</span> <span class="n">calculateVarG</span><span class="p">(</span><span class="n">cat1</span><span class="p">,</span> <span class="n">low_mem</span><span class="o">=</span><span class="n">low_mem</span><span class="p">)</span>
            <span class="n">varg2</span> <span class="o">=</span> <span class="n">calculateVarG</span><span class="p">(</span><span class="n">cat2</span><span class="p">,</span> <span class="n">low_mem</span><span class="o">=</span><span class="n">low_mem</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;varg1 = </span><span class="si">%f</span><span class="s2">: sig_g = </span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">varg1</span><span class="p">,</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">varg1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;varg2 = </span><span class="si">%f</span><span class="s2">: sig_g = </span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">varg2</span><span class="p">,</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">varg2</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">cat3</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">varg3</span> <span class="o">=</span> <span class="n">varg2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">varg3</span> <span class="o">=</span> <span class="n">calculateVarG</span><span class="p">(</span><span class="n">cat3</span><span class="p">,</span> <span class="n">low_mem</span><span class="o">=</span><span class="n">low_mem</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;varg3 = </span><span class="si">%f</span><span class="s2">: sig_g = </span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">varg3</span><span class="p">,</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">varg3</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="n">varg1</span><span class="p">,</span><span class="n">varg2</span><span class="p">,</span><span class="n">varg3</span><span class="p">)</span></div>

<div class="viewcode-block" id="GGGCrossCorrelation.getStat"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCrossCorrelation.getStat">[docs]</a>    <span class="k">def</span> <span class="nf">getStat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The standard statistic for the current correlation object as a 1-d array.</span>

<span class="sd">        In this case, the concatenation of zeta.ravel() for each combination in the following</span>
<span class="sd">        order: g1g2g3, g1g3g2, g2g1g3, g2g3g1, g3g1g2, g3g2g1.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">ggg</span><span class="o">.</span><span class="n">getStat</span><span class="p">()</span> <span class="k">for</span> <span class="n">ggg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all</span><span class="p">])</span></div>

<div class="viewcode-block" id="GGGCrossCorrelation.getWeight"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCrossCorrelation.getWeight">[docs]</a>    <span class="k">def</span> <span class="nf">getWeight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The weight array for the current correlation object as a 1-d array.</span>

<span class="sd">        In this case, the concatenation of getWeight() for each combination in the following</span>
<span class="sd">        order: g1g2g3, g1g3g2, g2g1g3, g2g3g1, g3g1g2, g3g2g1.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">ggg</span><span class="o">.</span><span class="n">getWeight</span><span class="p">()</span> <span class="k">for</span> <span class="n">ggg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all</span><span class="p">])</span></div>

<div class="viewcode-block" id="GGGCrossCorrelation.write"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCrossCorrelation.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Write the cross-correlation functions to the file, file_name.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            file_name (str):    The name of the file to write to.</span>
<span class="sd">            file_type (str):    The type of file to write (&#39;ASCII&#39; or &#39;FITS&#39;).  (default: determine</span>
<span class="sd">                                the type automatically from the extension of file_name.)</span>
<span class="sd">            precision (int):    For ASCII output catalogs, the desired precision. (default: 4;</span>
<span class="sd">                                this value can also be given in the constructor in the config dict.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Writing GGG cross-correlations to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">file_name</span><span class="p">)</span>

        <span class="n">col_names</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;r_nom&#39;</span><span class="p">,</span> <span class="s1">&#39;u_nom&#39;</span><span class="p">,</span> <span class="s1">&#39;v_nom&#39;</span><span class="p">,</span> <span class="s1">&#39;meand1&#39;</span><span class="p">,</span> <span class="s1">&#39;meanlogd1&#39;</span><span class="p">,</span> <span class="s1">&#39;meand2&#39;</span><span class="p">,</span> <span class="s1">&#39;meanlogd2&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;meand3&#39;</span><span class="p">,</span> <span class="s1">&#39;meanlogd3&#39;</span><span class="p">,</span> <span class="s1">&#39;meanu&#39;</span><span class="p">,</span> <span class="s1">&#39;meanv&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;gam0r&#39;</span><span class="p">,</span> <span class="s1">&#39;gam0i&#39;</span><span class="p">,</span> <span class="s1">&#39;gam1r&#39;</span><span class="p">,</span> <span class="s1">&#39;gam1i&#39;</span><span class="p">,</span> <span class="s1">&#39;gam2r&#39;</span><span class="p">,</span> <span class="s1">&#39;gam2i&#39;</span><span class="p">,</span> <span class="s1">&#39;gam3r&#39;</span><span class="p">,</span> <span class="s1">&#39;gam3i&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;sigma_gam0&#39;</span><span class="p">,</span> <span class="s1">&#39;sigma_gam1&#39;</span><span class="p">,</span> <span class="s1">&#39;sigma_gam2&#39;</span><span class="p">,</span> <span class="s1">&#39;sigma_gam3&#39;</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">,</span> <span class="s1">&#39;ntri&#39;</span> <span class="p">]</span>
        <span class="n">group_names</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;g1g2g3&#39;</span><span class="p">,</span> <span class="s1">&#39;g1g3g2&#39;</span><span class="p">,</span> <span class="s1">&#39;g2g1g3&#39;</span><span class="p">,</span> <span class="s1">&#39;g2g3g1&#39;</span><span class="p">,</span> <span class="s1">&#39;g3g1g2&#39;</span><span class="p">,</span> <span class="s1">&#39;g3g2g1&#39;</span> <span class="p">]</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span> <span class="n">ggg</span><span class="o">.</span><span class="n">rnom</span><span class="p">,</span> <span class="n">ggg</span><span class="o">.</span><span class="n">u</span><span class="p">,</span> <span class="n">ggg</span><span class="o">.</span><span class="n">v</span><span class="p">,</span>
                      <span class="n">ggg</span><span class="o">.</span><span class="n">meand1</span><span class="p">,</span> <span class="n">ggg</span><span class="o">.</span><span class="n">meanlogd1</span><span class="p">,</span> <span class="n">ggg</span><span class="o">.</span><span class="n">meand2</span><span class="p">,</span> <span class="n">ggg</span><span class="o">.</span><span class="n">meanlogd2</span><span class="p">,</span>
                      <span class="n">ggg</span><span class="o">.</span><span class="n">meand3</span><span class="p">,</span> <span class="n">ggg</span><span class="o">.</span><span class="n">meanlogd3</span><span class="p">,</span> <span class="n">ggg</span><span class="o">.</span><span class="n">meanu</span><span class="p">,</span> <span class="n">ggg</span><span class="o">.</span><span class="n">meanv</span><span class="p">,</span>
                      <span class="n">ggg</span><span class="o">.</span><span class="n">gam0r</span><span class="p">,</span> <span class="n">ggg</span><span class="o">.</span><span class="n">gam0i</span><span class="p">,</span> <span class="n">ggg</span><span class="o">.</span><span class="n">gam1r</span><span class="p">,</span> <span class="n">ggg</span><span class="o">.</span><span class="n">gam1i</span><span class="p">,</span>
                      <span class="n">ggg</span><span class="o">.</span><span class="n">gam2r</span><span class="p">,</span> <span class="n">ggg</span><span class="o">.</span><span class="n">gam2i</span><span class="p">,</span> <span class="n">ggg</span><span class="o">.</span><span class="n">gam3r</span><span class="p">,</span> <span class="n">ggg</span><span class="o">.</span><span class="n">gam3i</span><span class="p">,</span>
                      <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ggg</span><span class="o">.</span><span class="n">vargam0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ggg</span><span class="o">.</span><span class="n">vargam1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ggg</span><span class="o">.</span><span class="n">vargam2</span><span class="p">),</span>
                      <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ggg</span><span class="o">.</span><span class="n">vargam3</span><span class="p">),</span> <span class="n">ggg</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="n">ggg</span><span class="o">.</span><span class="n">ntri</span> <span class="p">]</span>
                    <span class="k">for</span> <span class="n">ggg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all</span> <span class="p">]</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;coords&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="s1">&#39;metric&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">metric</span><span class="p">,</span>
                   <span class="s1">&#39;sep_units&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sep_units</span><span class="p">,</span> <span class="s1">&#39;bin_type&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin_type</span> <span class="p">}</span>

        <span class="k">if</span> <span class="n">precision</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">precision</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;precision&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

        <span class="n">gen_multi_write</span><span class="p">(</span>
            <span class="n">file_name</span><span class="p">,</span> <span class="n">col_names</span><span class="p">,</span> <span class="n">group_names</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="n">file_type</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span></div>

<div class="viewcode-block" id="GGGCrossCorrelation.read"><a class="viewcode-back" href="../../ggg.html#treecorr.GGGCrossCorrelation.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read in values from a file.</span>

<span class="sd">        This should be a file that was written by TreeCorr, preferably a FITS file, so there</span>
<span class="sd">        is no loss of information.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            The `GGGCrossCorrelation` object should be constructed with the same configuration</span>
<span class="sd">            parameters as the one being read.  e.g. the same min_sep, max_sep, etc.  This is not</span>
<span class="sd">            checked by the read function.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            file_name (str):    The name of the file to read in.</span>
<span class="sd">            file_type (str):    The type of file (&#39;ASCII&#39; or &#39;FITS&#39;).  (default: determine the type</span>
<span class="sd">                                automatically from the extension of file_name.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Reading GGG cross-correlations from </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">file_name</span><span class="p">)</span>

        <span class="n">group_names</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;g1g2g3&#39;</span><span class="p">,</span> <span class="s1">&#39;g1g3g2&#39;</span><span class="p">,</span> <span class="s1">&#39;g2g1g3&#39;</span><span class="p">,</span> <span class="s1">&#39;g2g3g1&#39;</span><span class="p">,</span> <span class="s1">&#39;g3g1g2&#39;</span><span class="p">,</span> <span class="s1">&#39;g3g2g1&#39;</span> <span class="p">]</span>

        <span class="n">groups</span> <span class="o">=</span> <span class="n">gen_multi_read</span><span class="p">(</span>
                <span class="n">file_name</span><span class="p">,</span> <span class="n">group_names</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="n">file_type</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logr</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">params</span><span class="p">),</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="n">group_names</span><span class="p">):</span>
            <span class="n">ggg</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">ggg</span><span class="o">.</span><span class="n">_ro</span><span class="o">.</span><span class="n">rnom</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;r_nom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">ggg</span><span class="o">.</span><span class="n">_ro</span><span class="o">.</span><span class="n">logr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">ggg</span><span class="o">.</span><span class="n">rnom</span><span class="p">)</span>
            <span class="n">ggg</span><span class="o">.</span><span class="n">_ro</span><span class="o">.</span><span class="n">u</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;u_nom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">ggg</span><span class="o">.</span><span class="n">_ro</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;v_nom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">ggg</span><span class="o">.</span><span class="n">meand1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;meand1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">ggg</span><span class="o">.</span><span class="n">meanlogd1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;meanlogd1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">ggg</span><span class="o">.</span><span class="n">meand2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;meand2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">ggg</span><span class="o">.</span><span class="n">meanlogd2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;meanlogd2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">ggg</span><span class="o">.</span><span class="n">meand3</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;meand3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">ggg</span><span class="o">.</span><span class="n">meanlogd3</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;meanlogd3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">ggg</span><span class="o">.</span><span class="n">meanu</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;meanu&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">ggg</span><span class="o">.</span><span class="n">meanv</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;meanv&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">ggg</span><span class="o">.</span><span class="n">gam0r</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;gam0r&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">ggg</span><span class="o">.</span><span class="n">gam0i</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;gam0i&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">ggg</span><span class="o">.</span><span class="n">gam1r</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;gam1r&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">ggg</span><span class="o">.</span><span class="n">gam1i</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;gam1i&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">ggg</span><span class="o">.</span><span class="n">gam2r</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;gam2r&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">ggg</span><span class="o">.</span><span class="n">gam2i</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;gam2i&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">ggg</span><span class="o">.</span><span class="n">gam3r</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;gam3r&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">ggg</span><span class="o">.</span><span class="n">gam3i</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;gam3i&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="c1"># Read old output files without error.</span>
            <span class="n">ggg</span><span class="o">.</span><span class="n">vargam0</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sigma_gam0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">ggg</span><span class="o">.</span><span class="n">vargam1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sigma_gam1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">ggg</span><span class="o">.</span><span class="n">vargam2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sigma_gam2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">ggg</span><span class="o">.</span><span class="n">vargam3</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sigma_gam3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">ggg</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">ggg</span><span class="o">.</span><span class="n">ntri</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;ntri&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">ggg</span><span class="o">.</span><span class="n">coords</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;coords&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">ggg</span><span class="o">.</span><span class="n">metric</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;metric&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">ggg</span><span class="o">.</span><span class="n">_ro</span><span class="o">.</span><span class="n">sep_units</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;sep_units&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">ggg</span><span class="o">.</span><span class="n">_ro</span><span class="o">.</span><span class="n">bin_type</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;bin_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, Mike Jarvis.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>